<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Miyuru Tech Blog RSS Feed]]></title><description><![CDATA[Miyurus Tech Blog.]]></description><link>http://github.com/dylang/node-rss</link><generator>GatsbyJS</generator><lastBuildDate>Sat, 28 Feb 2026 15:07:16 GMT</lastBuildDate><item><title><![CDATA[Fixing IPv6 and Performance Issues on ZLT S12 Pro Router (OpenWrt)]]></title><description><![CDATA[Introduction As mentioned in the previous post, I reached out to the ISP to solve the issues, but only got feedback: ‚ÄúThe necessary‚Ä¶]]></description><link>https://blog.miyuru.lk/zlt-ipv6-fixes/</link><guid isPermaLink="false">https://blog.miyuru.lk/zlt-ipv6-fixes/</guid><pubDate>Thu, 26 Feb 2026 18:17:00 GMT</pubDate><content:encoded>&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;As mentioned in the &lt;a href=&quot;https://blog.miyuru.lk/s12-pro-ipv6-issue/&quot;&gt;previous post&lt;/a&gt;, I reached out to the ISP to solve the issues, but only got feedback: &lt;em&gt;‚ÄúThe necessary corrections will be made by the technical team.‚Äù&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;That didn‚Äôt help, so I decided to take matters into my own hands after watching a YouTube video on gaining telnet access to the router.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üìù &lt;strong&gt;Note:&lt;/strong&gt; I am using a ZLT S12 Pro router, and I have seen the same issues on the ZLT X25 PRO 5G. Most ZTE routers likely still use the same broken scripts.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;‚ö†Ô∏è &lt;strong&gt;Disclaimer:&lt;/strong&gt; These fixes are relatively harmless, but they might make your device unstable if applied incorrectly. Know what you are doing before applying the changes.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2&gt;Prerequisites: Get Telnet Access&lt;/h2&gt;
&lt;p&gt;You need to enable telnet on the router. The exact method may vary, but a quick search for your model should provide instructions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Hint:&lt;/strong&gt; You can find the steps for the S12 Pro model &lt;a href=&quot;#resources&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Fix 1: Adjust IPv6 Router Lifetime&lt;/h2&gt;
&lt;p&gt;The first issue was that IPv6 router advertisements (RA) had too short a lifetime, causing clients to drop their IPv6 addresses frequently.&lt;/p&gt;
&lt;p&gt;We can fix it by increasing &lt;code class=&quot;language-text&quot;&gt;ra_lifetime&lt;/code&gt; and enabling &lt;code class=&quot;language-text&quot;&gt;ra_useleasetime&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;uci &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; dhcp.lan.ra_lifetime=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;1800&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;uci &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; dhcp.lan.ra_useleasetime=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;1&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;uci commit dhcp&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;/etc/init.d/odhcpd restart&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Reference: &lt;a href=&quot;https://openwrt.org/docs/guide-user/base-system/dhcp&quot;&gt;OpenWrt DHCP Configuration&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;You can verify the change with &lt;code class=&quot;language-text&quot;&gt;rdisc6&lt;/code&gt;. After the fix, the RA output router lifetime of 1800 seconds:&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Fix 2: DHCPv6 Script Improvements&lt;/h2&gt;
&lt;p&gt;The main IPv6 problems of this router seem to stem from a broken DHCPv6 script.&lt;/p&gt;
&lt;h3&gt;2.1 Fixing Preferred and Valid Lifetimes&lt;/h3&gt;
&lt;p&gt;The router tries to implement a custom version of &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc7278&quot;&gt;RFC 7278&lt;/a&gt;. From my testing, the valid and preferred lifetimes are taken from the IPv6 prefix assigned to the &lt;code class=&quot;language-text&quot;&gt;br-lan&lt;/code&gt; interface. The script at &lt;code class=&quot;language-text&quot;&gt;/lib/netifd/dhcpv6.script&lt;/code&gt; contains these problematic lines:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Always take a backup before making changes:&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;cp /lib/netifd/dhcpv6.script /lib/netifd/dhcpv6.script.bak&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;addr_pref=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(echo $ADDRESSES &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; cut -d &amp;#39;,&amp;#39; -f 2)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;[ $addr_pref &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;-gt&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; 240 ] &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; addr_pref=240&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;addr_valid=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(echo $ADDRESSES &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; cut -d &amp;#39;,&amp;#39; -f 3)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;[ $addr_valid &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;-gt&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; 300 ] &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; addr_valid=300&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;ip addr add ${addr}/$mask dev br-${lan_section} preferred_lft $addr_pref valid_lft $addr_valid&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The script caps the preferred lifetime at 240 seconds and the valid lifetime at 300 seconds, which is far too short and create the decreasing values probem, snce it seem to think this is a link.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Fix:&lt;/strong&gt; Comment out or delete those lines, and use a simpler &lt;code class=&quot;language-text&quot;&gt;ip addr add&lt;/code&gt; without explicit lifetimes.&lt;/p&gt;
&lt;p&gt;After this change, the router will assign proper lifetimes, as seen in the &lt;code class=&quot;language-text&quot;&gt;rdisc6&lt;/code&gt; output below.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;3&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;Soliciting ff02::2 (ff02::2) on wlp0s20f3...&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;Hop limit                 &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;           64 (      0x40)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;Stateful address conf.    &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;           No&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;Stateful other conf.      &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;          Yes&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;Mobile home agent         &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;           No&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;Router preference         &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;       medium&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;Neighbor discovery proxy  &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;           No&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;Router lifetime           &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;         1800 (0x00000708) seconds&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;Reachable &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;            &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;  unspecified (0x00000000)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;Retransmit &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;           &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;  unspecified (0x00000000)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt; Source link-layer address: 98:A9:42:9C:68:21&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt; MTU                      &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;         1500 bytes (valid)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt; Prefix                   &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; 2001:db8:a400:2e76::/64&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  On-link                 &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;          Yes&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  Autonomous address conf.:          Yes&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  Valid &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;        86400 (0x00015180) seconds&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  Pref. &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;        86400 (0x00015180) seconds&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt; Recursive DNS server     &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; 2001:db8:a400:2e76:60b9:9aff:fe2d:b1e&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  DNS server lifetime     &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;         1800 (0x00000708) seconds&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;2.2 Preventing Unnecessary Address Deletion&lt;/h3&gt;
&lt;p&gt;Even after fixing lifetimes, disconnections still occurred because of this loop in the same script:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;4&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; temp &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(ip addr show dev br-${lan_section} &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; grep inet6 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; grep global &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; awk &amp;#39;{print $2}&amp;#39;)&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    ip addr del $temp dev br-${lan_section}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It removes &lt;strong&gt;all&lt;/strong&gt; global IPv6 addresses every time the script runs, which is why IPv6 disconnected from time to time.
The better way is to check and remove addresses that differ from the new one being added.&lt;/p&gt;
&lt;p&gt;I replaced that block with a new function so that we can fix the both issues in one go:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;5&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Function to update IPv6 address on bridge interface&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Parameters: $1 = new address (with mask), $2 = bridge interface name&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk6&quot;&gt;update_ipv6_address&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;() {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; new_addr=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;$1&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; bridge_interface=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;$2&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;# Remove existing global IPv6 addresses only if different from new address&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;# Combined grep|grep|awk into single awk for better performance&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    ip addr show dev &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;$bridge_interface&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; awk &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;/inet6.*global/ {print $2}&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; -r temp&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;# Only delete if address is different from the one we&amp;#39;re adding&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; [ &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;$temp&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;!=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;$new_addr&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; ]&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;then&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;            ip addr del &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;$temp&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; dev &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;$bridge_interface&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;fi&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;# Add new IPv6 address&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    ip addr add &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;$new_addr&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; dev &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;$bridge_interface&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Hint:&lt;/strong&gt; You can find the complete modified script for the S12 Pro model at the bottom of this &lt;a href=&quot;#resources&quot;&gt;article&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Replace the old deletion+addition code with a call to this function. After updating the script, IPv6 addresses persist correctly.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Fix 3: Disable NAT66 Masquerade&lt;/h2&gt;
&lt;p&gt;Even after fixing disconnections, I noticed that all devices behind the router appeared to have the same public IPv6 address. The router was performing NAT66 on the &lt;code class=&quot;language-text&quot;&gt;br-lan&lt;/code&gt; interface. We can confirm this with:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;6&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;ip6tables -t nat -vnL --line-numbers&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Example output:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;7&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Chain POSTROUTING (policy ACCEPT 21 packets, 1763 bytes)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;num   pkts bytes target     prot opt in     out     source               destination         &lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;1      112 51586 MASQUERADE  all      *      usb0    ::/0                 ::/0   &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The masquerade rule was added by a script at &lt;code class=&quot;language-text&quot;&gt;/usr/lib/lua/tz/firewall.sh&lt;/code&gt; with a comment, that explains the whole situation clearly.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;8&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# temporary fix for broken IPv6 function&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;ipv6_masq=1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is the relevant section that uses the var:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;9&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; [ $main_apn_nat &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; 1 ]&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;then&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; temp_if &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(uci get network.4g.ifname)&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        iptables -w -t nat -A POSTROUTING -o $temp_if -j MASQUERADE&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        [ &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;$ipv6_masq&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; ] &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; ip6tables -w -t nat -A POSTROUTING -o $temp_if -j MASQUERADE&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;fi&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To permanently disable IPv6 masquerade, we can set the &lt;code class=&quot;language-text&quot;&gt;$ipv6_masq&lt;/code&gt; variable to empty and reboot:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Backup first:&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;10&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;cp /usr/lib/lua/tz/firewall.sh /usr/lib/lua/tz/firewall.sh.bak&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;11&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sed -i &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;s/ipv6_masq=1/ipv6_masq=/g&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; /usr/lib/lua/tz/firewall.sh&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To apply immediately without reboot, delete the NAT rule:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;12&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;ip6tables -t nat -D POSTROUTING 1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now each device gets its own global IPv6 address as intended.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Bonus: Reduce System Load by Fixing wand Logging&lt;/h2&gt;
&lt;p&gt;During debugging, I noticed the router‚Äôs load average was constantly around 1. A quick &lt;code class=&quot;language-text&quot;&gt;top&lt;/code&gt; showed a &lt;code class=&quot;language-text&quot;&gt;wc -c&lt;/code&gt; process eating CPU:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;13&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;2834  2833 root     R     1380   1%  23% wc -c /tmp/logs/wand.log&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The log file &lt;code class=&quot;language-text&quot;&gt;/tmp/logs/wand.log&lt;/code&gt; had grown huge. This logging comes from the script &lt;code class=&quot;language-text&quot;&gt;/bin/wand&lt;/code&gt;. The original script continuously appends to the log and also checks its size for rotation, using &lt;code class=&quot;language-text&quot;&gt;wc -c&lt;/code&gt; which reads the entire file each time‚Äîexpensive on a large file.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Fix:&lt;/strong&gt; Comment out all logging and log‚Äërotation lines. Here‚Äôs the diff of the modified portion of the script with comments:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Backup first:&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;14&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;cp /bin/wand /bin/wand.bak&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;diff&quot; data-index=&quot;15&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-echo &amp;quot;wand started at[$(cat /proc/uptime | cut -d &amp;#39; &amp;#39; -f 1)], pid[$$]&amp;quot; &amp;gt;&amp;gt;$log_file&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+# Initial startup log - COMMENTED OUT&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+# echo &amp;quot;wand started at[$(cat /proc/uptime | cut -d &amp;#39; &amp;#39; -f 1)], pid[$$]&amp;quot; &amp;gt;&amp;gt;$log_file&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt; while true; do&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # Write current process ID to PID file for tracking&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;         echo $$ &amp;gt;$pid_file&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # Update last active timestamp (system uptime in seconds)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;         cat /proc/uptime | awk -F &amp;#39;.&amp;#39; &amp;#39;{print $1}&amp;#39; &amp;gt;/tmp/.wand/last_active&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-        set -x&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-        cat /proc/uptime&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # Debug output - COMMENTED OUT&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # set -x&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # cat /proc/uptime&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # Create timeout task if tick counter exceeds check interval&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;         if [ $tick -gt $check_interval ]; then&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                 touch $task_dir/timeout&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;         fi&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # Process all pending tasks in task directory&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;         while true; do&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                 no_task=1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-                for i in $(ls $task_dir); do&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+                for i in $(ls $task_dir 2&amp;gt;/dev/null); do&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+                        # Remove task file and execute failover&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                         rm -rf $task_dir/$i&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                         run_wan_failover&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+                        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+                        # Reset tick counter after task execution&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                         tick=0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                         no_task=0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                         break&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                 done&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+                # Exit loop if no tasks found&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                 [ $no_task -eq 1 ] &amp;amp;&amp;amp; break&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;         done&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # Monitor DNS resolver configuration&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;         watch_resolv&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # Increment tick counter and wait&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;         tick=$(($tick + $tick_step))&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;         sleep $tick_step&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-        set +x&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-        log_size=$(wc -c $log_file | awk &amp;#39;{print $1}&amp;#39;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-        [ -z &amp;quot;$log_size&amp;quot; ] &amp;amp;&amp;amp; log_size=0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-        if [ $log_size -gt $log_max_size ]; then&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-                rm -f $pid_file&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-                gzip -kf $log_file&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-                &amp;gt;$log_file&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-        fi&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk14&quot;&gt;-done &amp;gt;&amp;gt;$log_file 2&amp;gt;&amp;amp;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # Debug output end - COMMENTED OUT&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # set +x&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # Log rotation logic - COMMENTED OUT (not needed without logging)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # log_size=$(wc -c $log_file 2&amp;gt;/dev/null | awk &amp;#39;{print $1}&amp;#39;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # [ -z &amp;quot;$log_size&amp;quot; ] &amp;amp;&amp;amp; log_size=0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # if [ $log_size -gt $log_max_size ]; then&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        #         rm -f $pid_file&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        #         gzip -kf $log_file&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        #         &amp;gt;$log_file&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        # fi&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk16&quot;&gt;+done # Removed: &amp;gt;&amp;gt;$log_file 2&amp;gt;&amp;amp;1 (log redirection commented out)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Hint:&lt;/strong&gt; The complete modified &lt;code class=&quot;language-text&quot;&gt;wand&lt;/code&gt; script for the S12 Pro is available at the bottom of this &lt;a href=&quot;#resources&quot;&gt;article&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;After editing the file, restart the service:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;16&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;/etc/init.d/wand restart&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The load average dropped back to normal.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Persistence&lt;/h2&gt;
&lt;p&gt;All script changes made are permanent and survive a reboot. Reset will revert only the configs set via &lt;code class=&quot;language-text&quot;&gt;uci&lt;/code&gt; (Fix 1).&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;After applying these changes, the router became much more stable, and IPv6 now works as intended on all devices.&lt;/p&gt;
&lt;p&gt;Most of the problems stem from the fact that there is no proper DHCP‚ÄëPD for end devices, and &lt;a href=&quot;https://blog.miyuru.lk/server-provider-deploy-ipv6-correctly/&quot;&gt;ISPs are still trying to apply legacy v4 practices to IPv6&lt;/a&gt;. Hopefully, this situation will improve in the future.&lt;/p&gt;
&lt;h2&gt;Resources&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;‚ùó Always make a copy of the original files before applying any modifications, and compare the differences to understand the changes.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Modified scripts for ZLT S12 Pro:
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/1772291174219.66537872741/new_dhcpv6.sh&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;new_dhcpv6.sh&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/1772291174219.66537872743/new_wand.sh&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;new_wand.sh&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/1772291174219.66537872742/new_firewall.sh&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;new_firewall.sh&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/1772291174219.6017872739/how_to_telnet.txt&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;how_to_telnet.txt&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;This project took 2 days of research and testing. If you found this helpful, consider supporting me via &lt;a href=&quot;https://donate.stripe.com/00wdR98qH1vR41yfxKbfO01&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Please add a note about this blog post so I know it‚Äôs from here.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk15 { color: #9966B8; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .mtk7 { color: #225588; }
  .abyss .mtk3 { color: #384887; }
  .abyss .mtk6 { color: #DDBB88; }
  .abyss .mtk14 { color: #DC322F; }
  .abyss .mtk16 { color: #219186; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[IPv6 Keeps Breaking on Android with ZLT S12 Pro Router]]></title><description><![CDATA[I got a new router from a new ISP to check its IPv6 support. The router (ZLT S12 Pro) has an interesting IPv6 bug. Its IPv6 connection gets‚Ä¶]]></description><link>https://blog.miyuru.lk/s12-pro-ipv6-issue/</link><guid isPermaLink="false">https://blog.miyuru.lk/s12-pro-ipv6-issue/</guid><pubDate>Wed, 26 Nov 2025 13:07:00 GMT</pubDate><content:encoded>&lt;p&gt;I got a new router from a new ISP to check its IPv6 support. The router (ZLT S12 Pro) has an interesting IPv6 bug. Its IPv6 connection gets disconnected on Linux and is completely unusable on Android.&lt;/p&gt;
&lt;p&gt;I checked the SLAAC settings using the &lt;strong&gt;rdisc6&lt;/strong&gt; tool, and it seems the router sends the following values:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Router lifetime: 4 minutes&lt;/li&gt;
&lt;li&gt;Valid time: 4 minutes&lt;/li&gt;
&lt;li&gt;Preferred time: 2 minutes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;These are the maximum values, and they get lower over time because of the timers on successive solicitations.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Hop limit                 :           64 (      0x40)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Stateful address conf.    :           No&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Stateful other conf.      :          Yes&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Mobile home agent         :           No&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Router preference         :       medium&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Neighbor discovery proxy  :           No&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Router lifetime           :          189 (0x000000bd) seconds&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Reachable time            :  unspecified (0x00000000)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Retransmit time           :  unspecified (0x00000000)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt; Source link-layer address: 98:A9:42:9C:68:21&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt; MTU                      :         1500 bytes (valid)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt; Prefix                   : 2001:db8:a400:xxxx::/64&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  On-link                 :          Yes&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  Autonomous address conf.:          Yes&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  Valid time              :          191 (0x000000bf) seconds&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  Pref. time              :           71 (0x00000047) seconds&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt; Recursive DNS server     : 2001:db8:a400:xxxx:xxxx:xxxx:xxxx:xxxx&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  DNS server lifetime     :          189 (0x000000bd) seconds&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt; from fe80::9aa9:42ff:fe9c:6821&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There are multiple problems here.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;These values are too low and should not be dynamic on a end users router.&lt;/li&gt;
&lt;li&gt;Android discards lifetimes lower than 3 minutes. [IPv6 RA with AdvDefaultLifetime less than 180s not accepted by Android&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;](&lt;a href=&quot;https://issuetracker.google.com/issues/428412059&quot;&gt;https://issuetracker.google.com/issues/428412059&lt;/a&gt;)&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;The router also uses the preferred time as a timer. All values reset when it reaches zero. At zero it sometimes it sends an RA packet with a &lt;strong&gt;0 router lifetime&lt;/strong&gt;, which should not happen.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Hop limit                 :           64 (      0x40)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Stateful address conf.    :           No&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Stateful other conf.      :          Yes&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Mobile home agent         :           No&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Router preference         :       medium&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Neighbor discovery proxy  :           No&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Router lifetime           :            0 (0x00000000) seconds&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Reachable time            :  unspecified (0x00000000)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Retransmit time           :  unspecified (0x00000000)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt; Source link-layer address: 98:A9:42:9C:68:21&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt; MTU                      :         1500 bytes (valid)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt; Recursive DNS server     : fe80::9aa9:42ff:fe9c:6821&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  DNS server lifetime     :         1800 (0x00000708) seconds&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt; from fe80::9aa9:42ff:fe9c:6821&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This also triggers another Android bug. Which discards the IPv6 connection &lt;a href=&quot;https://issuetracker.google.com/issues/429703129&quot;&gt;Android loses IPv6 route after RA with lifetime 0 and refuses to restore it
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;One of the way to fix it is the router should use static values and implement the guidelines in:
&lt;a href=&quot;https://datatracker.ietf.org/doc/html/draft-ietf-6man-slaac-renum-02#section-4.1.1&quot;&gt;draft-ietf-6man-slaac-renum-02 Section 4.1.1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I have reached to the ISP to fix this issue. Will update this post when they fix it.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Update:&lt;/strong&gt; The ISP did not fix the issue; however, I managed to solve it myself.&lt;/p&gt;
&lt;p&gt;üëâ &lt;strong&gt;New Post:&lt;/strong&gt; &lt;a href=&quot;https://blog.miyuru.lk/zlt-ipv6-fixes/&quot;&gt;https://blog.miyuru.lk/zlt-ipv6-fixes/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[The Curious Case of IPv6 CNAME Chains on Linux Hosts]]></title><description><![CDATA[I was testing my IPv6 DNS Proxy Server while adding azurewebsite IPv6 support. Microsoft, unlike most providers, loves using multiple‚Ä¶]]></description><link>https://blog.miyuru.lk/linux-hosts-aaaa-records/</link><guid isPermaLink="false">https://blog.miyuru.lk/linux-hosts-aaaa-records/</guid><pubDate>Fri, 14 Nov 2025 20:25:00 GMT</pubDate><content:encoded>&lt;p&gt;I was testing my &lt;a href=&quot;https://gitlab.com/miyurusankalpa/IPv6-dns-server&quot;&gt;IPv6 DNS Proxy Server&lt;/a&gt; while adding azurewebsite IPv6 support. Microsoft, unlike most providers, loves using multiple chained CNAME records. Since I needed to detect modify requests by the CNAME level, I stumbled onto a weird quirk with Linux‚Äôs &lt;code class=&quot;language-text&quot;&gt;host&lt;/code&gt; command.&lt;/p&gt;
&lt;p&gt;Modern browsers send &lt;strong&gt;separate A and AAAA queries&lt;/strong&gt; for the same domain name.
But the Linux &lt;code class=&quot;language-text&quot;&gt;host&lt;/code&gt; command? It does something unexpected.&lt;/p&gt;
&lt;p&gt;It queries the &lt;strong&gt;A record&lt;/strong&gt; using the &lt;strong&gt;original name&lt;/strong&gt;,
then queries the &lt;strong&gt;AAAA record&lt;/strong&gt; using the &lt;strong&gt;last CNAME&lt;/strong&gt; in the chain.&lt;/p&gt;
&lt;p&gt;Here‚Äôs what it looks like:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;A lookup:&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;website.example.com ‚Üí cname1.example.net ‚Üí cname2.example.net  ‚Üí (IPv4 address)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;AAAA lookup:&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;cname2.example.net ‚Üí (IPv6 address)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here is how it looks like with wireshark, when resolving &lt;code class=&quot;language-text&quot;&gt;teams.microsoft.com&lt;/code&gt; with host command&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174218.3257872723/e4d4a/wireshark-host-cname-teams.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 4.430379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAQklEQVR42mPYdPrufxDeeenp/303XgPxm//7b8LwazB9+O7H/8fuff5/9D4Q3/v0/wgUg9hH73/6f+w+RO7Ygy//AQW7RpNfvRL4AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Wireshark capture showing separate A and AAAA queries for teams.microsoft.com&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174218.3257872723/f058b/wireshark-host-cname-teams.png&quot;
        srcset=&quot;/static/1772291174218.3257872723/c26ae/wireshark-host-cname-teams.png 158w,
/static/1772291174218.3257872723/6bdcf/wireshark-host-cname-teams.png 315w,
/static/1772291174218.3257872723/f058b/wireshark-host-cname-teams.png 630w,
/static/1772291174218.3257872723/40601/wireshark-host-cname-teams.png 945w,
/static/1772291174218.3257872723/78612/wireshark-host-cname-teams.png 1260w,
/static/1772291174218.3257872723/e4d4a/wireshark-host-cname-teams.png 2198w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;It sends a query for &lt;code class=&quot;language-text&quot;&gt;s-0005.dual-s-msedge.net&lt;/code&gt; (the last CNAME of A) for AAAA records, instead of &lt;code class=&quot;language-text&quot;&gt;teams.microsoft.com&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This doesn‚Äôt usually break anything, most DNS servers return consistent chains for both A and AAAA records.
But when you‚Äôre debugging or modifying DNS requests (like I was), this behavior can cause confusion.&lt;/p&gt;
&lt;p&gt;So next time you‚Äôre debugging DNS, &lt;strong&gt;don‚Äôt just trust &lt;code class=&quot;language-text&quot;&gt;host&lt;/code&gt;&lt;/strong&gt;.
Use &lt;code class=&quot;language-text&quot;&gt;dig&lt;/code&gt; and inspect &lt;strong&gt;both A and AAAA paths&lt;/strong&gt; manually to see the full picture.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[GGC Domain Decoding]]></title><description><![CDATA[I use IPvFoo to check website connectivity and I noticed that YouTube video domains had funny-looking subdomains.  So I did some digging for‚Ä¶]]></description><link>https://blog.miyuru.lk/ggc-domain-decode/</link><guid isPermaLink="false">https://blog.miyuru.lk/ggc-domain-decode/</guid><pubDate>Thu, 17 Jul 2025 12:53:00 GMT</pubDate><content:encoded>&lt;p&gt;I use &lt;a href=&quot;https://addons.mozilla.org/en-US/firefox/addon/ipvfoo/&quot;&gt;IPvFoo&lt;/a&gt; to check website connectivity and I noticed that YouTube video domains had funny-looking subdomains.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174212.96347872579/2009c/ipvfoo_yt.webp&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.34177215189873%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/webp;base64,UklGRkIAAABXRUJQVlA4IDYAAADQAgCdASoUAAcAPtFUpEuoJKOhsAgBABoJZwAAe/QAAP7uV9K94CLzA7va2ISNzC59m48AAAA=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;YouTube domains as seen in IPvFoo&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174212.96347872579/8aab1/ipvfoo_yt.webp&quot;
        srcset=&quot;/static/1772291174212.96347872579/81b7c/ipvfoo_yt.webp 158w,
/static/1772291174212.96347872579/6ea66/ipvfoo_yt.webp 315w,
/static/1772291174212.96347872579/8aab1/ipvfoo_yt.webp 630w,
/static/1772291174212.96347872579/2009c/ipvfoo_yt.webp 789w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;So I did some digging for more these domains and found this &lt;a href=&quot;https://github.com/skyoo/googlevideo_subdomains&quot;&gt;repo&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Looking at the repo and PTR records of the IPs, it looked like that these domains are encoded using a simple &lt;a href=&quot;https://en.wikipedia.org/wiki/Substitution_cipher&quot;&gt;Substitution cipher&lt;/a&gt;. The domains are structured like &lt;code class=&quot;language-text&quot;&gt;r[num]---sn-[encodedid].googlevideo.com&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;So with a little bit of Python, I got the cipher maps for the domains.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Plain&lt;/th&gt;
&lt;th&gt;Cipher&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;l&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;z&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;d&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;k&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;r&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;c&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;c&lt;/td&gt;
&lt;td&gt;j&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;d&lt;/td&gt;
&lt;td&gt;q&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;x&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;f&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;g&lt;/td&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;h&lt;/td&gt;
&lt;td&gt;i&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;i&lt;/td&gt;
&lt;td&gt;p&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;j&lt;/td&gt;
&lt;td&gt;w&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;k&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;l&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;m&lt;/td&gt;
&lt;td&gt;h&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;o&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;o&lt;/td&gt;
&lt;td&gt;v&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;p&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;r&lt;/td&gt;
&lt;td&gt;g&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;s&lt;/td&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t&lt;/td&gt;
&lt;td&gt;u&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;u&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;v&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;w&lt;/td&gt;
&lt;td&gt;f&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;x&lt;/td&gt;
&lt;td&gt;m&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;y&lt;/td&gt;
&lt;td&gt;t&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;z&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;I created the liitle html page to decode this in the browser, you can view it &lt;a href=&quot;https://miyuru.lk/ggcdomaindecorder&quot;&gt;https://miyuru.lk/ggcdomaindecorder&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Looks like encoded bits are mostly ISP ID and the server ID in google systems. Why they thought to encode this info is still a mystery.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Server Providers Deploy IPv6 Correctly]]></title><description><![CDATA[Why IPv6 Deserves Better Treatment from Hosting Providers Most server providers treat IPv6 the same way they treat IPv4. On the surface‚Ä¶]]></description><link>https://blog.miyuru.lk/server-provider-deploy-ipv6-correctly/</link><guid isPermaLink="false">https://blog.miyuru.lk/server-provider-deploy-ipv6-correctly/</guid><pubDate>Sun, 22 Jun 2025 09:22:00 GMT</pubDate><content:encoded>&lt;h1&gt;Why IPv6 Deserves Better Treatment from Hosting Providers&lt;/h1&gt;
&lt;p&gt;Most server providers treat IPv6 the same way they treat IPv4. On the surface, that might seem fair‚Äîbut in practice, it‚Äôs far from ideal.&lt;/p&gt;
&lt;p&gt;IPv4 addresses have become irregular, expensive, and severely limited. IPv6 was created to solve these very problems. Yet, many providers continue to use old habits instead of embracing IPv6‚Äôs strengths.&lt;/p&gt;
&lt;h2&gt;The Problem with IPv4&lt;/h2&gt;
&lt;p&gt;IPv4 space has already run out. To cope, server providers now recycle addresses, rely on NAT (Network Address Translation), or sell IPv6 address at a high cost. These workarounds lead to several issues:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Unpredictable IP allocations&lt;/li&gt;
&lt;li&gt;Poor routing hygiene&lt;/li&gt;
&lt;li&gt;Higher risk of bad IP reputation&lt;/li&gt;
&lt;li&gt;Making VPS prices higher&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Why IPv6 Deserves a Different Approach&lt;/h2&gt;
&lt;p&gt;IPv6 was designed to be scalable, efficient, and clean. It offers an enormous address space and better routing capabilities. But many providers still treat it like just another version of IPv4‚Äîlimiting its potential.&lt;/p&gt;
&lt;p&gt;To deliver a truly modern and reliable IPv6 experience, providers should rethink how they allocate and manage IPv6. Here‚Äôs how:&lt;/p&gt;
&lt;h3&gt;1. Allocate Subnets per Account&lt;/h3&gt;
&lt;p&gt;Instead of assigning random single IPv6 addresses, providers should allocate a IPv6 subnet per customer account and give customer the flexibility to design their own IP structure.&lt;/p&gt;
&lt;p&gt;Benefits include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Better organization&lt;/li&gt;
&lt;li&gt;Easier service isolation&lt;/li&gt;
&lt;li&gt;Room for scaling and growth&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2. Allow Users to Bring Their Own IPv6 Prefixes&lt;/h3&gt;
&lt;p&gt;Advanced users should have the option to bring their own IPv6 address blocks (known as BYOIP‚ÄîBring Your Own IP). This unlocks several advantages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Full control over IP reputation&lt;/li&gt;
&lt;li&gt;Easier migration between providers&lt;/li&gt;
&lt;li&gt;Consistent firewall rules and network architecture&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;3. Simplify Routing and Firewalls&lt;/h3&gt;
&lt;p&gt;With clear subnet boundaries and the ability to bring your own IP space, users can build more secure and efficient networks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cleaner firewall configurations&lt;/li&gt;
&lt;li&gt;Better route filtering&lt;/li&gt;
&lt;li&gt;Fewer IP conflicts across services&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;4. Protect IPv6 Reputation&lt;/h3&gt;
&lt;p&gt;On shared IPv6 prefixes, one bad actor can damage the reputation of the entire block‚Äîimpacting all users. With dedicated subnets or user-owned prefixes, reputation problems are isolated to individual accounts.&lt;/p&gt;
&lt;p&gt;This is especially critical for services like:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Email delivery&lt;/li&gt;
&lt;li&gt;Public APIs&lt;/li&gt;
&lt;li&gt;Web hosting&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Final Thoughts&lt;/h2&gt;
&lt;p&gt;IPv6 is the future, but only if we stop applying outdated IPv4 practices to it. Hosting providers need to start building IPv6 services that are scalable, secure, and user-friendly.&lt;/p&gt;
&lt;p&gt;So far, AWS is one of the few major providers deploying IPv6 with this modern mindset‚Äîoffering subnet-level control and support for user-owned prefixes.&lt;/p&gt;
&lt;p&gt;Let‚Äôs hope others follow soon.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Adding IPv6 Support to SES in AWS SDK]]></title><description><![CDATA[In this post I am going to show how to enable IPv6 (dual stack) support for Amazon SES in AWS PHP SDK, JavaScript SDK and Python SDK (boto‚Ä¶]]></description><link>https://blog.miyuru.lk/adding-ipv6-support-to-ses-in-aws-sdk/</link><guid isPermaLink="false">https://blog.miyuru.lk/adding-ipv6-support-to-ses-in-aws-sdk/</guid><pubDate>Mon, 12 May 2025 14:53:00 GMT</pubDate><content:encoded>&lt;p&gt;In this post I am going to show how to enable IPv6 (dual stack) support for Amazon SES in AWS PHP SDK, JavaScript SDK and Python SDK (boto3).&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;‚ö†Ô∏è Note: Despite the blog post on May 5, 2025, the AWS SDK does not seem to support the dualstack endpoint at the posting of the blog post. This blog post uses a custom function to get and set the dualstack endpoint. &lt;a href=&quot;https://aws.amazon.com/about-aws/whats-new/2025/05/amazon-ses-ipv6-calling-ses-outbound-endpoints/&quot;&gt;https://aws.amazon.com/about-aws/whats-new/2025/05/amazon-ses-ipv6-calling-ses-outbound-endpoints/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;To enable IPv6 in PHP, add the &lt;code class=&quot;language-text&quot;&gt;use_dualstack_endpoint&lt;/code&gt; option to the configuration:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;php&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt; * Return the SES API endpoint domain for a given region.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt; *&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt; * &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;@param&lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt; $region AWS region (e.g. &amp;quot;eu-central-1&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt; * &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;@return&lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;string&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;getSesApiEndpoint&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; $region)&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;email.$region.api.aws&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;; &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;// Usage:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;$region &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;eu-central-1&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;$SesClient &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;SesClient&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;([&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;version&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;                  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;2010-12-01&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;region&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;                   &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; $region,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;use_dualstack_endpoint&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;   &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;endpoint&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;                 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;https://&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;getSesApiEndpoint&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;($region), &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;//tmp fix till the endpoints are added to SDK&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;]);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To enable IPv6 in JavaScript, add the &lt;code class=&quot;language-text&quot;&gt;useDualstackEndpoint&lt;/code&gt; option to the configuration:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;js&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt; * Return the SES API endpoint URL for a given region.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt; * &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;@param&lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk5 mtku&quot;&gt;{string}&lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt; region AWS region, e.g. &amp;quot;eu-central-1&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt; * &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;@returns&lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk5 mtku&quot;&gt;{string}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;getSesApiEndpoint&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;) {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;`https://email.${&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;}.api.aws`&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;// Usage:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; region &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;eu-central-1&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; client &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk5 mtku&quot;&gt;SESClient&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;({&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  region,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  useDualstackEndpoint: &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  endpoint: &lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;getSesApiEndpoint&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(region) &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;//tmp fix till the endpoints are added to SDK&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;});&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To enable IPv6 in Python (boto3), set the &lt;code class=&quot;language-text&quot;&gt;use_dualstack_endpoint&lt;/code&gt; parameter when creating the client:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;python&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;get_ses_api_endpoint&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;) -&amp;gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;    Return the SES API endpoint URL for a given region.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;https://email.&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;.api.aws&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Usage:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;region &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;eu-central-1&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;ses &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; boto3.client(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;ses&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;region_name&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;region,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;use_dualstack_endpoint&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;endpoint_url&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;get_ses_api_endpoint(region) &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;#tmp fix till the endpoints are added to SDK&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtku {
    text-decoration: underline;
    text-underline-position: under;
  }
  .abyss .mtki { font-style: italic; }
  .abyss .mtk3 { color: #384887; }
  .abyss .mtk7 { color: #225588; }
  .abyss .mtk15 { color: #9966B8; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk6 { color: #DDBB88; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .mtk4 { color: #F280D0; }
  .abyss .mtk5 { color: #FFEEBB; }
  .abyss .mtk19 { color: #2277FF; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[IPv6 Support in Public Docker Registries]]></title><description><![CDATA[Back in 2021, I checked for IPv6 support in public registries in the Docker Hub IPv6 support thread. Since Docker Hub now has IPv6 support‚Ä¶]]></description><link>https://blog.miyuru.lk/ipv6-docker-registries-2025/</link><guid isPermaLink="false">https://blog.miyuru.lk/ipv6-docker-registries-2025/</guid><pubDate>Tue, 15 Apr 2025 22:27:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://github.com/docker/roadmap/issues/89#issuecomment-772644009&quot;&gt;Back in 2021, I checked for IPv6 support in public registries in the Docker Hub IPv6 support thread&lt;/a&gt;. Since Docker Hub now has IPv6 support, I wanted to see how other registries have fared.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;‚ö†Ô∏è Note:&lt;/strong&gt; The registry domains referenced here might change in the future. For a full domain list and upto date infomation on IPv6 support, please refer to the &lt;a href=&quot;https://v6monitor.com/list/view/cf170dba3/&quot;&gt;v6monitor list&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Results&lt;/h2&gt;
&lt;p&gt;Below are the tests I conducted using various registry domains. For each registry, I recorded the Docker endpoint result and used tcpdump to get the auth/blob domain. The registry endpoint is in &lt;strong&gt;bold&lt;/strong&gt;.&lt;/p&gt;
&lt;h2&gt;Public Container Registries&lt;/h2&gt;
&lt;h3&gt;Docker Hub: Fully supports IPv6&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;docker.io (registry-1.docker.io)&lt;/strong&gt;: &lt;strong&gt;PASS ‚úÖ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;docker-images-prod.6aa30f8b08e16409b46e0173d6de2f56.r2.cloudflarestorage.com: PASS ‚úÖ&lt;/li&gt;
&lt;li&gt;production.cloudflare.docker.com: PASS ‚úÖ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Red Hat Quay: Fully supports IPv6&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;quay.io&lt;/strong&gt;: &lt;strong&gt;PASS ‚úÖ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;cdn01.quay.io: PASS ‚úÖ&lt;/li&gt;
&lt;li&gt;cdn02.quay.io: PASS ‚úÖ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;GitHub Container Registry: Only blob endpoint supports IPv6&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ghcr.io&lt;/strong&gt;: &lt;strong&gt;FAIL ‚ùå&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;pkg-containers.githubusercontent.com: PASS ‚úÖ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;GitLab Container Registry: No IPv6 support&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;registry.gitlab.com&lt;/strong&gt;: &lt;strong&gt;FAIL ‚ùå&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;cdn.registry.gitlab-static.net: FAIL ‚ùå&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;AWS Public ECR: Default endpoint does not have IPv6&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;public.ecr.aws&lt;/strong&gt;: &lt;strong&gt;FAIL ‚ùå&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ecr-public.aws.com&lt;/strong&gt;: &lt;strong&gt;PASS ‚úÖ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;d5l0dvt14r5h8.cloudfront.net: PASS ‚úÖ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Scaleway Docker Registry: Only blob domain supports IPv6&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;rg.nl-ams.scw.cloud&lt;/strong&gt;: &lt;strong&gt;FAIL ‚ùå&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;api.scaleway.com: FAIL ‚ùå&lt;/li&gt;
&lt;li&gt;s3.nl-ams.scw.cloud: PASS ‚úÖ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Google Artifact Registry: Fully supports IPv6&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;gcr.io&lt;/strong&gt;: &lt;strong&gt;PASS ‚úÖ&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Alibaba Cloud Registry: Only auth domain supports IPv6&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;registry.cn-hangzhou.aliyuncs.com&lt;/strong&gt;: &lt;strong&gt;FAIL ‚ùå&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;dockerauth.cn-hangzhou.aliyuncs.com: PASS ‚úÖ&lt;/li&gt;
&lt;li&gt;aliregistry.oss-cn-hangzhou.aliyuncs.com: FAIL ‚ùå&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Public Offical Container Registries&lt;/h2&gt;
&lt;h3&gt;Microsoft Container Registry: Fully supports IPv6&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;mcr.microsoft.com&lt;/strong&gt;: &lt;strong&gt;PASS ‚úÖ&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Kubernetes Registry: Supports IPv6&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;registry.k8s.io&lt;/strong&gt;: &lt;strong&gt;PASS ‚úÖ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;prod-registry-k8s-io-ap-south-1.s3.dualstack.ap-south-1.amazonaws.com: PASS ‚úÖ&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;‚ö†Ô∏è Note: Blob endpoint seems to use different provider S3 buckets based on regions. For my region, it has IPv6 support. You can find the complete bucket list &lt;a href=&quot;https://github.com/kubernetes/registry.k8s.io/blob/main/cmd/archeio/internal/app/buckets.go&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Redirect Domains&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;registry.access.redhat.com&lt;/strong&gt;: Domain supports IPv6. Then it redirects to Red Hat Quay.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;lscr.io&lt;/strong&gt;: Domain does not support IPv6. Then it redirects to GitHub Container Registry.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Summary and Recommendations&lt;/h2&gt;
&lt;p&gt;Based on the tests conducted, here‚Äôs a summary table of registry IPv6 support and recommendations for environments where IPv6 is crucial:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Registry&lt;/th&gt;
&lt;th&gt;Docker Endpoint&lt;/th&gt;
&lt;th&gt;Blob Endpoint&lt;/th&gt;
&lt;th&gt;Overall IPv6 Support&lt;/th&gt;
&lt;th&gt;Recommendation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Docker Hub&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;Full&lt;/td&gt;
&lt;td&gt;Recommended&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Red Hat Quay&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;Full&lt;/td&gt;
&lt;td&gt;Recommended&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Google Artifact Registry&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;Full&lt;/td&gt;
&lt;td&gt;Recommended&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Microsoft Container Registry&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;Full&lt;/td&gt;
&lt;td&gt;Recommended&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Kubernetes Registry&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;Full&lt;/td&gt;
&lt;td&gt;Recommended&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AWS Public ECR&lt;/td&gt;
&lt;td&gt;üöß&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;Almost there&lt;/td&gt;
&lt;td&gt;Need to use a seperate endpoint&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GitHub Container Registry&lt;/td&gt;
&lt;td&gt;‚ùå&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;Partial&lt;/td&gt;
&lt;td&gt;Recommend to use with NAT64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Scaleway Docker Registry&lt;/td&gt;
&lt;td&gt;‚ùå&lt;/td&gt;
&lt;td&gt;‚úÖ&lt;/td&gt;
&lt;td&gt;Partial&lt;/td&gt;
&lt;td&gt;Recommend to use with NAT64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Alibaba Cloud Registry&lt;/td&gt;
&lt;td&gt;‚ùå&lt;/td&gt;
&lt;td&gt;‚ùå&lt;/td&gt;
&lt;td&gt;None&lt;/td&gt;
&lt;td&gt;Not recommended&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GitLab Container Registry&lt;/td&gt;
&lt;td&gt;‚ùå&lt;/td&gt;
&lt;td&gt;‚ùå&lt;/td&gt;
&lt;td&gt;None&lt;/td&gt;
&lt;td&gt;Not recommended&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;For IPv6-only or IPv6-first environments, I recommend using registries with full IPv6 support such as Docker Hub, Red Hat Quay and Google Artifact Registry.&lt;/p&gt;
&lt;p&gt;I recommend using NAT64 because the blob endpoint handles the most bandwidth-intensive downloads, which puts the most burden on the NAT64 server. You can use one from &lt;a href=&quot;https://nat64.xyz/&quot;&gt;https://nat64.xyz/&lt;/a&gt;, but in my testing, most of them seemed to be rate-limited at the Docker endpoint due to high usage.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Speed Up Your Network with Google BBR]]></title><description><![CDATA[Google‚Äôs BBR (Bottleneck Bandwidth and Round-trip propagation time) is a congestion control algorithm that can significantly improve network‚Ä¶]]></description><link>https://blog.miyuru.lk/linux-google-brr/</link><guid isPermaLink="false">https://blog.miyuru.lk/linux-google-brr/</guid><pubDate>Fri, 28 Feb 2025 19:27:00 GMT</pubDate><content:encoded>&lt;p&gt;Google‚Äôs BBR (Bottleneck Bandwidth and Round-trip propagation time) is a congestion control algorithm that can significantly improve network performance. In this post, I‚Äôll guide you through enabling BBR on your Linux system to boost network speeds.&lt;/p&gt;
&lt;h2&gt;What is BBR?&lt;/h2&gt;
&lt;p&gt;BBR is a TCP congestion control algorithm developed by Google that optimizes network throughput and reduces latency. Unlike traditional loss-based congestion control algorithms, BBR uses bandwidth and round-trip time measurements to build a model of the network, allowing for better utilization of available bandwidth.&lt;/p&gt;
&lt;h2&gt;Prerequisites&lt;/h2&gt;
&lt;p&gt;Before we begin, ensure you have:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A Linux system with root access&lt;/li&gt;
&lt;li&gt;A kernel version 4.9 or newer&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Step 1: Check if BBR is available in your kernel&lt;/h2&gt;
&lt;p&gt;First, let‚Äôs check if BBR is available in your system:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo sysctl net.ipv4.tcp_available_congestion_control&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If BBR is available, you should see something like:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;net.ipv4.tcp_available_congestion_control = reno cubic bbr&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If BBR is not listed, you may need to load the module:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo modprobe tcp_bbr&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Verify the module is loaded:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;3&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;lsmod &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; grep bbr&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Step 2: Configure the system to use BBR&lt;/h2&gt;
&lt;p&gt;Now, we need to configure the system to use BBR. Create or edit the sysctl configuration file:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;4&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo nano /etc/sysctl.conf&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Add the following lines at the end of the file:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;5&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;net.core.default_qdisc = cake&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;net.ipv4.tcp_congestion_control = bbr&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: The &lt;code class=&quot;language-text&quot;&gt;cake&lt;/code&gt; qdisc (queue discipline) works well with BBR. Alternatively, you can use &lt;code class=&quot;language-text&quot;&gt;fq&lt;/code&gt; if &lt;code class=&quot;language-text&quot;&gt;cake&lt;/code&gt; is not available.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Step 3: Apply the changes&lt;/h2&gt;
&lt;p&gt;Apply the new settings:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;6&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo sysctl -p&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Step 4: Verify BBR is enabled&lt;/h2&gt;
&lt;p&gt;To confirm BBR is now active:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;7&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo sysctl net.ipv4.tcp_congestion_control&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You should see:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;8&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;net.ipv4.tcp_congestion_control = bbr&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Benefits of Using BBR&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Higher throughput&lt;/strong&gt;: BBR can achieve higher network throughput compared to other congestion control algorithms.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Lower latency&lt;/strong&gt;: It reduces bufferbloat and maintains lower latencies.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Better performance on lossy networks&lt;/strong&gt;: BBR handles packet loss more efficiently than traditional algorithms.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Improved experience&lt;/strong&gt;: Faster downloads, smoother streaming, and better overall connection stability.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;By enabling Google‚Äôs BBR algorithm on your Linux system, you can significantly improve your network performance. BBR is particularly effective for high-bandwidth, high-latency connections, but it can benefit almost any network environment.&lt;/p&gt;
&lt;p&gt;Remember that kernel updates may reset these settings, so you might need to reapply them after major system updates.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk7 { color: #225588; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Intel Network PCIe Issue]]></title><description><![CDATA[I recently encountered a puzzling network issue on an Intel Network VM. The kernel was up-to-date, and all configurations seemed correct‚Ä¶]]></description><link>https://blog.miyuru.lk/intel-network-kernal-iisue/</link><guid isPermaLink="false">https://blog.miyuru.lk/intel-network-kernal-iisue/</guid><pubDate>Sun, 18 Aug 2024 01:15:00 GMT</pubDate><content:encoded>&lt;p&gt;I recently encountered a puzzling network issue on an Intel Network VM. The kernel was up-to-date, and all configurations seemed correct, yet the network connection was dropping intermittently, causing a full network outage. In this blog post, I‚Äôll walk you through the steps I took to identify and resolve the issue.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The Problem:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The network connection on the VM would drop randomly, causing a full network outage. Upon inspecting the system logs, I found the following error message:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;[132915.070196] igb 0000:04:00.0 eth0: PCIe link lost&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This error message indicated that the PCIe link was lost on the Ethernet interface (eth0). However, I couldn‚Äôt understand why this was happening, as the kernel was up-to-date and the hardware was functioning correctly.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Troubleshooting Steps:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;To troubleshoot this issue, I followed these steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Verified Hardware Configuration:&lt;/strong&gt; I verified that the hardware configuration was correct and that the Ethernet interface was properly connected to the switch.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Checked for Firmware Updates:&lt;/strong&gt; I checked for firmware updates for the Intel Network VM, but there were no updates available.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Inspected System Logs:&lt;/strong&gt; I inspected the system logs to see if there were any other error messages related to the network interface.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;The Solution:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;After some research&lt;sup&gt;&lt;a href=&quot;https://forum.proxmox.com/threads/network-card-drop-igc-0000-09-00-0-eno1-pcie-link-lost.121295/&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;, I discovered that adding specific kernel parameters  might solve the issue. I added the following parameters to the kernel command line:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;pcie_port_pm=off pcie_aspm.policy=performance&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;These parameters disable PCIe port power management and set the ASPM policy to performance.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Edit the &lt;code class=&quot;language-text&quot;&gt;/etc/default/grub&lt;/code&gt; file and add the following line to the &lt;code class=&quot;language-text&quot;&gt;GRUB_CMDLINE_LINUX&lt;/code&gt; variable:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;GRUB_CMDLINE_LINUX=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;pcie_port_pm=off pcie_aspm.policy=performance&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;run the following command to update the GRUB configuration:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo update-grub&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;I rebooted the system to apply the changes.&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;Note: Verify that the kernel parameters are being applied by checking the system logs or running the &lt;code class=&quot;language-text&quot;&gt;cat /proc/cmdline&lt;/code&gt; command.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Conclusion:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In this blog post, I demonstrated how I troubleshooted and resolved a mysterious network issue on an Intel Network VM. By adding specific kernel parameters to the GRUB configuration, I was able to resolve the issue with the PCIe link and restore network connectivity.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Setting up Grafana Alerts to monitor Applications]]></title><description><![CDATA[In the world of modern application development and infrastructure management, effective monitoring is crucial. Grafana provides a powerful‚Ä¶]]></description><link>https://blog.miyuru.lk/grafana-alerts/</link><guid isPermaLink="false">https://blog.miyuru.lk/grafana-alerts/</guid><pubDate>Wed, 03 Jul 2024 23:29:00 GMT</pubDate><content:encoded>&lt;p&gt;In the world of modern application development and infrastructure management, effective monitoring is crucial. Grafana provides a powerful platform for visualizing and alerting on various metrics. In this post, we will walk through setting up Grafana and configuring alerts.&lt;/p&gt;
&lt;p&gt;We will use a setup that includes Prometheus and Process Exporter to monitor our environment. Grafana will be used to visualize the metrics and set up alerts. We will also use MailCatcher to test email-based alerts.&lt;/p&gt;
&lt;h3&gt;Prerequisites&lt;/h3&gt;
&lt;p&gt;Before we start, ensure you have Docker and Docker Compose installed on your system.&lt;/p&gt;
&lt;h3&gt;Docker Compose Configuration&lt;/h3&gt;
&lt;p&gt;Below is the Docker Compose file that will set up Prometheus, Grafana, Process Exporter, and MailCatcher.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;yaml&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;3.8&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;monitoring&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;driver&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;bridge&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;prometheus_data&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: {}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;grafana_storage&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: {}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;grafana&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;grafana/grafana-oss&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;grafana&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;unless-stopped&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;     - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;3000:3000&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;     - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;grafana_storage:/var/lib/grafana&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;GF_SMTP_ENABLED=true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;GF_SMTP_HOST=mailcatcher:1025&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;GF_SMTP_FROM_ADDRESS=your-email@example.com&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;monitoring&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;process-exporter&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;ncabatoff/process-exporter&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;process-exporter&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;privileged&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;/proc:/host/proc:ro&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;./filename.yml:/config/filename.yml&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;--procfs=/host/proc&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;-config.path=/config/filename.yml&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;expose&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;9256&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;monitoring&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;prometheus&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;prometheus&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;prom/prometheus:latest&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;prometheus&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;unless-stopped&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;./prometheus.yml:/etc/prometheus/prometheus.yml&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;prometheus_data:/prometheus&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;--config.file=/etc/prometheus/prometheus.yml&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;--storage.tsdb.path=/prometheus&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;--web.console.libraries=/etc/prometheus/console_libraries&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;--web.console.templates=/etc/prometheus/consoles&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;--web.enable-lifecycle&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;expose&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;9090&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;monitoring&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;grafana&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;mailcatcher&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;schickling/mailcatcher&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;mailcatcher&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;unless-stopped&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;1080:1080&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;1025:1025&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;monitoring&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;Step-by-Step Setup&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create Docker Compose File&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Save the above Docker Compose configuration in a file named &lt;code class=&quot;language-text&quot;&gt;docker-compose.yml&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create Prometheus Configuration&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Create a &lt;code class=&quot;language-text&quot;&gt;prometheus.yml&lt;/code&gt; file with the following content:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;yaml&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;global&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;scrape_interval&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;10s&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;scrape_configs&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  - &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;job_name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;prometheus&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;static_configs&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;targets&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: [&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;prometheus:9090&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  - &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;job_name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;process-exporter&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;static_configs&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;targets&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: [&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;process-exporter:9256&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This configuration file sets up Prometheus to scrape metrics from itself and the Process Exporter.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Create Process Exporter Configuration&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Create a &lt;code class=&quot;language-text&quot;&gt;filename.yml&lt;/code&gt; file for the process exporter:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;yaml&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;process_names&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  - &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;{{.Comm}}&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;cmdline&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;.+&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Start Services&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In the directory containing your &lt;code class=&quot;language-text&quot;&gt;docker-compose.yml&lt;/code&gt;, run the following command:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;3&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;docker-compose up -d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This command will start all the services in the background.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;‚ö†Ô∏è If there are any issues use &lt;code class=&quot;language-text&quot;&gt;docker logs $container_name&lt;/code&gt; to check the logs.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Access Grafana&lt;/h3&gt;
&lt;p&gt;Open your browser and go to &lt;code class=&quot;language-text&quot;&gt;http://localhost:3000&lt;/code&gt;. The default login credentials are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Username: &lt;code class=&quot;language-text&quot;&gt;admin&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Password: &lt;code class=&quot;language-text&quot;&gt;admin&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Adding Data Source&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;In Grafana, navigate to &lt;strong&gt;Configuration&lt;/strong&gt; -&gt; &lt;strong&gt;Data Sources&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Add data source&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Select &lt;strong&gt;Prometheus&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Set the URL to &lt;code class=&quot;language-text&quot;&gt;http://prometheus:9090&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Save &amp;#x26; Test&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Setting Up Email-Based Alerts&lt;/h3&gt;
&lt;p&gt;In Grafana:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Go to &lt;strong&gt;Alerting&lt;/strong&gt; -&gt; &lt;strong&gt;Contact points&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Contact point&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Name your contact point and select &lt;strong&gt;Email&lt;/strong&gt; as the type.&lt;/li&gt;
&lt;li&gt;Enter the recipient email address.&lt;/li&gt;
&lt;li&gt;Save the contact point.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Setting Up Alerts&lt;/h3&gt;
&lt;p&gt;We want to monitor the chrome browser procces in this test.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Navigate to the &lt;strong&gt;Alert&lt;/strong&gt; tab.&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Create Alert&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;In new alert page add the following query.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;namedprocess_namegroup_num_procs{groupname=&quot;chromium-browse&quot;}&lt;/code&gt;
4. Set Threshold to monitor input A and alert if below 1.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174214.63627872581/41027/alert.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 80.37974683544303%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB9ElEQVR42pVUyZbTQAzMPwwJ8dpud9u92c4Oc+LChRtHvojvFiU58Qx5TPI41JPStiolqdorbRz5dKAuTOSAYTqTizvq/EhZ2dC2UP/E57z+C7fzlbKRpjDSALK2i9S0jsrKIE/Uup2cWZfI9AlxkKgtfocj2XiGkD31qC+VFeJVqQyN04nSeCJtAlVNR2VtJCrjJcoZChicF3hu3UgRNZ1HZ3Evz7YFCIu6pR6HLZRaqDIAEyvtKA5H5J7yUsuZgVqtPYV0hKqdnGnUcTe17meFTDjtv9Dl6zd5qbm+xPE95sK4EDA4n5FEuSjMK00Jiximi7QQsCCfTtQzhh2wJ9snIfsIPNdad28KpWVeCNpbgOUoOIBzbqdq7EMwj2yZNzhgKcy+3pa0yas7S1RX1A+x2IatkKaT+E7bIIrm3L+9WKrZk6X60JcLoekjjbsL5ra/ziRc23fE870p2GRQCTwl5OIAezABD1a1/TU6yZm0UC3VFn7UvMnmMWHdejHmreXZBu8iRmDDQPF4wOanh9dRCG8b5XYy/HuOa5djY6xsAYydPVG2EBYK16oJ9GlT0MvLhtabNcgLzE3dbXFe0FOFFe4gG5e/Oia+kjv8oLIdoKhGsRaCezwkZHvwJ6v3kfzrLzr//E16/A6VOWWV/i8yJvwDFjC7w296zAsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Grafana Alert&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174214.63627872581/f058b/alert.png&quot;
        srcset=&quot;/static/1772291174214.63627872581/c26ae/alert.png 158w,
/static/1772291174214.63627872581/6bdcf/alert.png 315w,
/static/1772291174214.63627872581/f058b/alert.png 630w,
/static/1772291174214.63627872581/40601/alert.png 945w,
/static/1772291174214.63627872581/78612/alert.png 1260w,
/static/1772291174214.63627872581/41027/alert.png 2181w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol start=&quot;5&quot;&gt;
&lt;li&gt;select the email contact point configured previously.&lt;/li&gt;
&lt;li&gt;Save the alert.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Test Email Alerts&lt;/h3&gt;
&lt;p&gt;To test the email alerts, open your browser and go to &lt;code class=&quot;language-text&quot;&gt;http://localhost:1080&lt;/code&gt; to access MailCatcher‚Äôs web interface.&lt;/p&gt;
&lt;p&gt;Open and close the chrome browser and wait a few minutues.&lt;/p&gt;
&lt;p&gt;You should see the email notification in the web UI and that the alert is triggerd on the grafana UI.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174216.63627872583/56fe7/mailcatcher.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvklEQVR42q2Q3Q6DIAyFef9X3MUWF3+moiIKFCZnoFnixZzb3ElOKKH92sJO5xSXrEZaCiQ5R1ZLpJXAtWhwawaU7YiCD8hfOOYmxVKz3Hsw0bVoeY1xkBhkD6NHkFHhDFYjmqqA7AUs6WA1v60d89Yxwxt579E1HMZQiAFjPfbEYlH0FpCMwTRNIOsgldsH7k2o4+pEARimhD8GjJO1QoPIwlqLT8T2EqybZpi730MDfxz4XH3rn38CfqO/Ax9GKhTB5jclkgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;MailCatcher&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174216.63627872583/f058b/mailcatcher.png&quot;
        srcset=&quot;/static/1772291174216.63627872583/c26ae/mailcatcher.png 158w,
/static/1772291174216.63627872583/6bdcf/mailcatcher.png 315w,
/static/1772291174216.63627872583/f058b/mailcatcher.png 630w,
/static/1772291174216.63627872583/40601/mailcatcher.png 945w,
/static/1772291174216.63627872583/78612/mailcatcher.png 1260w,
/static/1772291174216.63627872583/56fe7/mailcatcher.png 6144w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtk7 { color: #225588; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .mtk4 { color: #F280D0; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Enabling IPv6 in Default VPC in AWS]]></title><description><![CDATA[IPv6 is the latest version of the Internet Protocol, which provides a larger address space, improved security, and enhanced performance for‚Ä¶]]></description><link>https://blog.miyuru.lk/aws-default-vpc-ipv6/</link><guid isPermaLink="false">https://blog.miyuru.lk/aws-default-vpc-ipv6/</guid><pubDate>Sat, 25 Nov 2023 16:04:00 GMT</pubDate><content:encoded>&lt;p&gt;IPv6 is the latest version of the Internet Protocol, which provides a larger address space, improved security, and enhanced performance for internet communications. However, AWS does not enable IPv6 by default in the default VPC, and some steps are required to enable it.&lt;/p&gt;
&lt;p&gt;In this blog post, we will show you how to use a simple bash script to enable IPv6 support in the default VPC and subnets.&lt;/p&gt;
&lt;h2&gt;Script&lt;/h2&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Get the default VPC ID&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;vpc_id=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(aws ec2 describe-vpcs \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --filters Name=isDefault,Values=true \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --query &amp;#39;Vpcs[0].VpcId&amp;#39; \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --output text)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Associate an Amazon-provided IPv6 CIDR block with the default VPC&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;aws ec2 associate-vpc-cidr-block \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  --vpc-id $vpc_id \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  --amazon-provided-ipv6-cidr-block&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Retrieve the assigned IPv6 CIDR block for the VPC&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;vpc_ipv6_cidr=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(aws ec2 describe-vpcs \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --vpc-ids $vpc_id \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --query &amp;#39;Vpcs[0].Ipv6CidrBlockAssociationSet[0].Ipv6CidrBlock&amp;#39; \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --output text)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Get all subnets in the VPC (returns array of [SubnetId, AvailabilityZone])&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;subnets=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(aws ec2 describe-subnets \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --filters Name=vpc-id,Values=$vpc_id \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --query &amp;#39;Subnets[*].[SubnetId,AvailabilityZone]&amp;#39; \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --output json)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Count total subnets&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;subnet_count=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(echo $subnets &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; jq length)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Loop subnets&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; i &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(seq 0 $((subnet_count &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;# Extract subnet ID and availability zone for current index&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  subnet_id=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(echo $subnets &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; jq -r .[$i][0])&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  subnet_az=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(echo $subnets &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; jq -r .[$i][1])&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;# Assign a /64 IPv6 CIDR to the subnet based on its AZ suffix (e.g. &amp;quot;1a&amp;quot; ‚Üí &amp;quot;1a::/64&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  aws ec2 associate-subnet-cidr-block \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    --subnet-id $subnet_id \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    --ipv6-cidr-block ${vpc_ipv6_cidr&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;::-&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;7}${subnet_az&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; -2}::/64&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  sleep 1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;# Enable automatic IPv6 address assignment for instances launched in this subnet&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  aws ec2 modify-subnet-attribute \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    --subnet-id $subnet_id \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    --assign-ipv6-address-on-creation&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Get the main route table for the VPC&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;route_table_id=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(aws ec2 describe-route-tables \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --filters Name=vpc-id,Values=$vpc_id \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --query &amp;#39;RouteTables[0].RouteTableId&amp;#39; \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --output text)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Get the Internet Gateway attached to the VPC&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;gateway_id=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(aws ec2 describe-internet-gateways \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --filters Name=attachment.vpc-id,Values=$vpc_id \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --query &amp;#39;InternetGateways[0].InternetGatewayId&amp;#39; \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk11&quot;&gt;  --output text)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Add a default IPv6 route (::/0) pointing to the Internet Gateway&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;aws ec2 create-route \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  --route-table-id $route_table_id \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  --destination-ipv6-cidr-block ::/0 \&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  --gateway-id $gateway_id&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Explanation&lt;/h2&gt;
&lt;p&gt;Here /56 for VPC and /64 for subnets are used. For subnets, last 2 letters of the Availability Zone are used. For example the subnet in &lt;code class=&quot;language-text&quot;&gt;eu-central-1c&lt;/code&gt; would get ip &lt;code class=&quot;language-text&quot;&gt;2001:db8:ffff:ff1c::/64&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The script starts by getting the ID of the default VPC. Then it assigns an IPv6 CIDR block to the default VPC from the amazons IPv6 pool and get the newly assigned IPv6 CIDR.&lt;/p&gt;
&lt;p&gt;Then it gets the subnets in the default VPC and loops through them and specify the custom IPv6 CIDR sub-block to each subnet and enable &lt;code class=&quot;language-text&quot;&gt;assign-ipv6-address-on-creation&lt;/code&gt; in each subnet.&lt;/p&gt;
&lt;p&gt;Then it gets the ID of the route table and internet gateway of the default subnet and then create a default IPv6 route in the route table of the default subnet.&lt;/p&gt;
&lt;h2&gt;Usage&lt;/h2&gt;
&lt;p&gt;Open a cloudshell in your aws account in the region you want to enable IPv6 for the default VPC.&lt;/p&gt;
&lt;p&gt;Save the script to a file (e.g., &lt;code class=&quot;language-text&quot;&gt;nano aws_ipv6_vpc.sh&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Make it executable: &lt;code class=&quot;language-text&quot;&gt;chmod +x aws_ipv6_vpc.sh&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Run the script: &lt;code class=&quot;language-text&quot;&gt;./aws_ipv6_vpc.sh&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Check your AWS console to verify that the subnets have IPv6 address.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Now your EC2 instances lauched in the default VPC will have IPv6 addresses by default. Make sure the configure the security groups to allow IPv6 traffic as well.
You can also test the connectivity to other IPv6-enabled resources on the internet! üòä&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtk3 { color: #384887; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .mtk7 { color: #225588; }
  .abyss .mtk4 { color: #F280D0; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Adding Cloudflare IP to AWS Prefix List]]></title><description><![CDATA[If you‚Äôre managing an AWS environment and want to keep your security groups up-to-date with Cloudflare‚Äôs IPv6 addresses, this script can‚Ä¶]]></description><link>https://blog.miyuru.lk/aws-cloudflare-ip-prefixlist/</link><guid isPermaLink="false">https://blog.miyuru.lk/aws-cloudflare-ip-prefixlist/</guid><pubDate>Thu, 05 Oct 2023 18:47:00 GMT</pubDate><content:encoded>&lt;p&gt;If you‚Äôre managing an AWS environment and want to keep your security groups up-to-date with Cloudflare‚Äôs IPv6 addresses, this script can help.
Cloudflare provides a list of their IPv6 addresses, and we‚Äôll use this information to create an AWS managed prefix list that you can reference in your security group rules.&lt;/p&gt;
&lt;h2&gt;Script&lt;/h2&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;curl -s https://www.cloudflare.com/ips-v6/ &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; /tmp/cloudflare_ipv6.txt&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;region=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;`aws ec2 describe-availability-zones --output text --query &amp;#39;AvailabilityZones[0].[RegionName]&amp;#39;`&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;# Add each IPv6 address to AWS prefix list&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; -r ipv6&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    entries+=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;Cidr=$ipv6,Description=Cloudflare_IPv6 &amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; /tmp/cloudflare_ipv6.txt&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15&quot;&gt;echo&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; $entries&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;entries_count=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;`wc -l &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; /tmp/cloudflare_ipv6.txt`&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;date=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;$(date &amp;#39;+%Y-%m-%d %H:%M:%S&amp;#39;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;aws ec2 create-managed-prefix-list --prefix-list-name &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;Cloudflare_IPv6_$date&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; --address-family IPv6 --max-entries $entries_count  --region $region --entries $entries &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Explanation&lt;/h2&gt;
&lt;p&gt;The script starts by downloading the list of Cloudflare‚Äôs IPv6 addresses using curl. These addresses are stored in a file called &lt;code class=&quot;language-text&quot;&gt;cloudflare_ipv6.txt&lt;/code&gt; in the tmp directory.&lt;/p&gt;
&lt;p&gt;Next, it determines the AWS region using the &lt;code class=&quot;language-text&quot;&gt;aws ec2 describe-availability-zones&lt;/code&gt; command.&lt;/p&gt;
&lt;p&gt;The while loop reads each line from &lt;code class=&quot;language-text&quot;&gt;/tmp/cloudflare_ipv6.txt&lt;/code&gt; and constructs a string of entries in the format required for creating an AWS prefix list.&lt;/p&gt;
&lt;p&gt;We calculate the number of entries in the file to set the &lt;code class=&quot;language-text&quot;&gt;max-entries&lt;/code&gt; parameter for the prefix list.&lt;/p&gt;
&lt;p&gt;The current date and time are captured using &lt;code class=&quot;language-text&quot;&gt;date&lt;/code&gt;, which will be included in the prefix list name.&lt;/p&gt;
&lt;p&gt;Finally, it uses &lt;code class=&quot;language-text&quot;&gt;aws ec2 create-managed-prefix-list&lt;/code&gt; to create the managed prefix list with a unique name based on the date and time.&lt;/p&gt;
&lt;h2&gt;Usage&lt;/h2&gt;
&lt;p&gt;Open a cloudshell in your aws account.&lt;/p&gt;
&lt;p&gt;Save the script to a file (e.g., &lt;code class=&quot;language-text&quot;&gt;nano cloudflare_aws.sh&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Make it executable: &lt;code class=&quot;language-text&quot;&gt;chmod +x cloudflare_aws.sh&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Run the script: &lt;code class=&quot;language-text&quot;&gt;./cloudflare_aws.sh&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Check your AWS console to verify that the new ‚ÄúCloudflare_IPv6‚Äù prefix list with a timestamp has been created.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Now you can reference this prefix list in your security group rules to allow traffic from Cloudflare‚Äôs IPv6 addresses.&lt;/p&gt;
&lt;p&gt;Feel free to customize this script further to add IPv4 support or integrate it into your existing automation workflows! üòä&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtk3 { color: #384887; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk7 { color: #225588; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .mtk15 { color: #9966B8; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Using Route53 to load balance autoscaling groups]]></title><description><![CDATA[A few years back I worked on a project on AWS with some friends and we needed to load balance traffic. To save on the cost of an ALB, I‚Ä¶]]></description><link>https://blog.miyuru.lk/route53-autoscaling-lambda-ddns/</link><guid isPermaLink="false">https://blog.miyuru.lk/route53-autoscaling-lambda-ddns/</guid><pubDate>Tue, 11 Jul 2023 18:21:00 GMT</pubDate><content:encoded>&lt;p&gt;A few years back I worked on a project on AWS with some friends and we needed to load balance traffic. To save on the cost of an ALB, I decided on using round-robin DNS load balancing with Route53 and it worked for a while with long running instances, when we moved to an auto scaling setup things started to break as instances scaled up and down and required manual intervention to update DNS.&lt;/p&gt;
&lt;p&gt;For most of us, the quick solution to this problem is to stick an ALB in front, but I decided to extend my DNS solution even further.&lt;/p&gt;
&lt;p&gt;My solution was to run a Python script in AWS Lambda which updates the DNS in Route53 when an instance state changes in the autoscaling group. (Similar to dynamic DNS services). It is really easy to get the public IPv4 address of the instances from the auto scaling groups. Getting the IPv6 address turned out to be a bit of work, but it was easy to do if there is only one IPv6 address per instance. Also a thing to note is to keep the TTL lower to limit the chances of clients hitting an expired IP address.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;python&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; boto3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;lambda_handler&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;):&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  ec2 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; boto3.client(&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;ec2&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  asg &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; boto3.client(&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;autoscaling&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  r53 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; boto3.client(&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;route53&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  response &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; asg.describe_auto_scaling_groups(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;AutoScalingGroupNames&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;[&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;asg-name&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      ],&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;MaxRecords&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  )&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  insids &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; []&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; asg &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; response[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;AutoScalingGroups&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; ins &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; asg[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Instances&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      insids.append(ins[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;InstanceId&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;])&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(insids)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  response &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; ec2.describe_instances(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;InstanceIds&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;insids&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  )&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  ipv4 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; []&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  ipv6 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; []&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; res &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; response[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Reservations&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; ins &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; res[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Instances&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      ipv4.append({&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Value&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: ins[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;PublicIpAddress&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;] })&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; net &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; ins[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;NetworkInterfaces&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; v6 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; net[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Ipv6Addresses&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          ipv6.append({&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Value&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: v6[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Ipv6Address&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;] })&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(ipv4)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(ipv6)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  domain &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;example.com&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  response &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; r53.change_resource_record_sets(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;HostedZoneId&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;ZZZZZZZZZZZ&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;ChangeBatch&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;{&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Comment&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;auto dns update for asg&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Changes&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: [&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;              {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                  &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Action&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;UPSERT&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                  &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;ResourceRecordSet&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                      &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Name&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: domain,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                      &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Type&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                      &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;TTL&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;300&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                      &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;ResourceRecords&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: ipv4&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                  }&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;              },&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;              {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                  &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Action&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;UPSERT&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                  &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;ResourceRecordSet&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                      &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Name&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: domain,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                      &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Type&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;AAAA&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                      &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;TTL&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;300&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                      &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;ResourceRecords&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: ipv6&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                  }&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;              },&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          ]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      }&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  )&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(response)  &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;For triggering the Lambda, I used Cloudwatch events to monitor the instance‚Äôs lifecycle actions. Below is the AWS SAM template for the Lambda function.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;yml&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;AWSTemplateFormatVersion&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;2010-09-09&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;Transform&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;AWS::Serverless-2016-10-31&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;An AWS Serverless Specification template describing your function.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;Resources&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;UpdateDNS&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;AWS::Serverless::Function&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;Handler&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;index.lambda_handler&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;Runtime&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;python3.8&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;CodeUri&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;MemorySize&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;128&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;Timeout&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;Role&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;arn:aws:iam::11111111111:role/service-role/UpdateDNS-role&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;Events&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;CloudWatchEvent1&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;CloudWatchEvent&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;            &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;Pattern&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;detail-type&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;EC2 Instance-launch Lifecycle Action&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;EC2 Instance-terminate Lifecycle Action&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;                - &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;aws.autoscaling&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the end, the solution worked perfectly and it also kept the cost low.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtki { font-style: italic; }
  .abyss .mtk7 { color: #225588; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk15 { color: #9966B8; }
  .abyss .mtk6 { color: #DDBB88; }
  .abyss .mtk19 { color: #2277FF; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .mtk4 { color: #F280D0; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[IPv6 only hosting list 2022]]></title><description><![CDATA[I use a couple of IPv6 only VPS and I though to document them and some others together. Here IPv6 only means, Native IPv6. No NAT IPv4 or‚Ä¶]]></description><link>https://blog.miyuru.lk/ipv6-hosting-2022/</link><guid isPermaLink="false">https://blog.miyuru.lk/ipv6-hosting-2022/</guid><pubDate>Thu, 22 Dec 2022 12:04:00 GMT</pubDate><content:encoded>&lt;p&gt;I use a couple of IPv6 only VPS and I though to document them and some others together.&lt;/p&gt;
&lt;p&gt;Here &lt;em&gt;IPv6 only&lt;/em&gt; means,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Native IPv6.&lt;/li&gt;
&lt;li&gt;No NAT IPv4 or NAT64.&lt;/li&gt;
&lt;li&gt;Removing IPv4 or NAT64 should reduce cost.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;IPv6 Only Provider List&lt;/h1&gt;
&lt;h2&gt;Free&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;server-factory.com - KVM-IPV6-XXS VPS - 1 shared vCPU, 2GB RAM, 50GB SSD (24 hours) - &lt;a href=&quot;https://my.server-factory.com/?affid=148&quot;&gt;aff link&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;euserv* - VS2-free(LXC) - 1 shared vCPU, 1GB RAM, 10GB HDD&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Not Free&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Scaleway - Stardust - 1 shared vCPU, 1GB RAM, 10GB SSD - ~$0.4&lt;/li&gt;
&lt;li&gt;server-factory.com - KVM-IPV6-1 VPS - 1 shared vCPU, 1GB RAM, 10GB SSD - ~$0.5&lt;/li&gt;
&lt;li&gt;1NEXTNET* - Starter - 1 shared vCPU, 512MB RAM, 10GB SSD - ~$0.5&lt;/li&gt;
&lt;li&gt;hosmatic* - VPS-N116 - 1 shared vCPU, 512MB RAM, 10GB SSD - ~$0.53&lt;/li&gt;
&lt;li&gt;hosteons* - IPv6 512 - 1 shared vCPU, 512MB RAM, 10GB SSD - ~$0.75&lt;/li&gt;
&lt;li&gt;HyperExpert* - MVPS1 - 1 shared vCPU, 512MB RAM, 5GB HDD - ~$0.99&lt;/li&gt;
&lt;li&gt;PCextreme* - standard - 1 shared vCPU, 1GB RAM, 25GB SSD - ~$1&lt;/li&gt;
&lt;li&gt;cinfu* - EX0FR - 1 shared vCPU, 256MB RAM, 20GB HDD - ~$1.05&lt;/li&gt;
&lt;li&gt;justhost.ru* - 1 shared vCPU, 512MB RAM, 5GB SSD - ~$1.77&lt;/li&gt;
&lt;li&gt;Signaltransmitter* - IPv6 &lt;strong&gt;LXC&lt;/strong&gt; X-Small - 1 shared vCPU, 512MB RAM, 20GB SSD - ~$1&lt;/li&gt;
&lt;li&gt;limitlesshost* - KVM IPv6 ONLY - 1 shared vCPU, 512MB RAM, 5GB SSD - ~$2&lt;/li&gt;
&lt;li&gt;hostsailor* - Mini Sailor KVM IPv6 - 1 shared vCPU, 256MB RAM, 10GB HDD - ~$2&lt;/li&gt;
&lt;li&gt;web.arena.ne.jp* - 1 shared vCPU, 768MB RAM, 20GB HDD - ~$2.24&lt;/li&gt;
&lt;li&gt;Signaltransmitter* - IPv6 &lt;strong&gt;KVM&lt;/strong&gt; X-Small - 1 shared vCPU, 512MB RAM, 20GB SSD - ~$2.5&lt;/li&gt;
&lt;li&gt;Vultr* - Regular - 1 shared vCPU, 512MB RAM, 10GB SSD - ~$2.5&lt;/li&gt;
&lt;li&gt;hostiko.com.ua* - DE-0 - 1 shared vCPU, 1GB RAM, 20GB SSD - ~$3.2&lt;/li&gt;
&lt;li&gt;Hetzner - CX11 - 1 shared vCPU, 2GB RAM, 20GB SSD - ~$4&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Honourable Mentions&lt;/h3&gt;
&lt;p&gt;Following 2 providers were not in the original list due to providing Free NAT64(IPv4 mostly), but due the immense support those 2 providers give to the IPv6 community, I am adding them below.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ipv6onlyhosting.com* - 1 shared vCPU, 1GB RAM, 10GB SSD - ~$3.75&lt;/li&gt;
&lt;li&gt;mythic-beasts* -  VPS 1 - 1 shared vCPU, 1GB RAM, 5GB SSD - ~$5.91&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note: * Means I have not tried the providers.&lt;/p&gt;
&lt;p&gt;Otherwise linked, all offers are Google searchable. Prices are monthly.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;If there are any hosts that I missed let me know on Mastodon.&lt;/p&gt;
&lt;h4&gt;References&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://ipv6.social/@jakob/109559287721814144&quot;&gt;https://ipv6.social/@jakob/109559287721814144&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://maobuni.com/tag/ipv6-vps/&quot;&gt;https://maobuni.com/tag/ipv6-vps/&lt;/a&gt;&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Pull Docker Images via IPv6]]></title><description><![CDATA[As IPv6 only servers are becoming the norm, lots of users run into the problem of pulling docker images from docker hub. ‚ö†Ô∏è As of August‚Ä¶]]></description><link>https://blog.miyuru.lk/dockerhub-ipv6/</link><guid isPermaLink="false">https://blog.miyuru.lk/dockerhub-ipv6/</guid><pubDate>Wed, 09 Nov 2022 19:19:00 GMT</pubDate><content:encoded>&lt;p&gt;As IPv6 only servers are becoming the norm, lots of users run into the problem of pulling docker images from docker hub.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;‚ö†Ô∏è As of August 2023 docker hub supports IPv6 &lt;a href=&quot;https://www.docker.com/blog/docker-hub-registry-ipv6-support-now-generally-available/&quot;&gt;https://www.docker.com/blog/docker-hub-registry-ipv6-support-now-generally-available/&lt;/a&gt; the following sentence have been updated to reflect that.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The default endpoint is dual stacked, but they have another endpoint &lt;code class=&quot;language-text&quot;&gt;registry.ipv6.docker.com&lt;/code&gt; which is IPv6 only.&lt;/p&gt;
&lt;p&gt;So instead of using
&lt;code class=&quot;language-text&quot;&gt;docker pull busybox&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;You can prefix the IPv6 docker endpoint with library and pull the docker image.
&lt;code class=&quot;language-text&quot;&gt;docker pull registry.ipv6.docker.com/library/busybox&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;However, this is only suitable for one time use and advanced users will need to edit dockerfiles to add the new endpoint.&lt;/p&gt;
&lt;p&gt;Instead of that, you can add the endpoint as a mirror to the config as solve this problem.&lt;/p&gt;
&lt;p&gt;In Linux config is at &lt;code class=&quot;language-text&quot;&gt;/etc/docker/daemon.json&lt;/code&gt;&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;   &amp;quot;registry-mirrors&amp;quot;: [&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;     &amp;quot;https://registry.ipv6.docker.com&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;   ]&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Setup WireGuard with global IPv6]]></title><description><![CDATA[WireGuard is becoming popular with the linux crowd as a VPN as its integrated with the linux kernel whitch provides better performance‚Ä¶]]></description><link>https://blog.miyuru.lk/setup-wireguard-with-global-ipv6/</link><guid isPermaLink="false">https://blog.miyuru.lk/setup-wireguard-with-global-ipv6/</guid><pubDate>Sun, 02 Jan 2022 01:25:00 GMT</pubDate><content:encoded>&lt;p&gt;WireGuard is becoming popular with the linux crowd as a VPN as its integrated with the linux kernel whitch provides better performance.&lt;/p&gt;
&lt;p&gt;However lot of tutorials and scripts that setup wireguard do so with NATing the IPv6 address and giving the user a link local IPv6 address. This causes the operating system to prefer IPv4 over IPv6. In this tutorial we will look at setting up a simple dual stacked vpn tunnel with global IPv6 support.&lt;/p&gt;
&lt;p&gt;I will be using a t4g.nano server in aws eu-central-1 with Debian bullseye and use add a single /80 ipv6 subnet for the instance. Some of the steps will be different for your setup.&lt;/p&gt;
&lt;h2&gt;Network Setup&lt;/h2&gt;
&lt;p&gt;For this tutorial I will be only focusing on IPv6 network configuration.&lt;/p&gt;
&lt;p&gt;You will need a subnet with /80 for this tutorial, However you can use smaller subnets with proper subnetting.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;‚ö†Ô∏è Please substitute your own subnet and network interfaces when following the tutorial.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Original Block - 2001:db8::ffaa:87dd::/80&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;For the SSH - 2001:db8::ffaa:87dd::1/128&lt;/li&gt;
&lt;li&gt;For the VPN Endpoint - 2001:db8::ffaa:87dd::123/128&lt;/li&gt;
&lt;li&gt;For the VPN Clients - 2001:db8::ffaa:87dd:ffff::/96&lt;/li&gt;
&lt;li&gt;VPN Endpoint port - 60002&lt;/li&gt;
&lt;li&gt;AWS network interface - ens5&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We are also giving a single IPv6 for each client but you can also give a subnet per client.
For a truly proper IPv6 config you can give each client a /64 subnet and configure SLAAC.&lt;/p&gt;
&lt;p&gt;Run the following commands to add the ips to the interface&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;sudo ip addr add 2001:db8::ffaa:87dd::1/128 dev ens5&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;sudo ip addr add 2001:db8::ffaa:87dd::123/128 dev ens5&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;sudo ip addr add 2001:db8::ffaa:87dd:ffff::/96 dev ens5&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;‚ö†Ô∏è You can also use tools like netplan to properly setup the IPs.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Make sure to add the following to &lt;code class=&quot;language-text&quot;&gt;/etc/sysctl.d/wg.conf&lt;/code&gt;&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;net.ipv4.ip_forward = 1&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;net.ipv6.conf.all.forwarding = 1&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;net.ipv6.conf.ens5.accept_ra = 2&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Run following command to apply the changes.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;sudo sysctl --system&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Installing WireGuard&lt;/h2&gt;
&lt;p&gt;To install WireGuard use the package manager of the system or follow the &lt;a href=&quot;https://www.wireguard.com/install/&quot;&gt;quickstart&lt;/a&gt;.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;3&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;sudo apt install wireguard&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Server WG0 Configuration&lt;/h2&gt;
&lt;p&gt;In the IPv4 rules, we NATing the IPv4 address.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;4&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;PostUp =  iptables -t nat -A POSTROUTING -o ens5 -j MASQUERADE; &lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;PostDown = iptables -t nat -D POSTROUTING -o ens5 -j MASQUERADE;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the IPv6 rules, we are adding a rule to forward traffic to the internet interface.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;5&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;PostUp = ip6tables -A FORWARD -i ens5 -o wg0 -j ACCEPT; ip6tables -A FORWARD -i wg0 -j ACCEPT;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;PostDown = ip6tables -D FORWARD -i ens5 -o wg0 -j ACCEPT; ip6tables -D FORWARD -i wg0 -j ACCEPT;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;For the client IP we are using the first IPs of the designated range. In IPv6 you can allow a large subnet here and it will allow the client to move around within different IPs of the subnet.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;6&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;AllowedIPs = 10.66.66.2, 2001:db8::ffaa:87dd:ffff::2/128&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Below is the full config. Save the file in &lt;code class=&quot;language-text&quot;&gt;/etc/wireguard/wg0.conf&lt;/code&gt;&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;7&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;[Interface]&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Address = 10.66.66.1/24, fd42:42:42::1/64&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;ListenPort = 60002&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;PrivateKey = &lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;PostUp =  iptables -t nat -A POSTROUTING -o ens5 -j MASQUERADE; ip6tables -A FORWARD -i ens5 -o wg0 -j ACCEPT; ip6tables -A FORWARD -i wg0 -j ACCEPT;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;PostDown = iptables -t nat -D POSTROUTING -o ens5 -j MASQUERADE; ip6tables -D FORWARD -i ens5 -o wg0 -j ACCEPT; ip6tables -D FORWARD -i wg0 -j ACCEPT;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;#### Client 1&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;[Peer]&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;PublicKey =&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;#PresharedKey =&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;AllowedIPs = 10.66.66.2, 2001:db8::ffaa:87dd:ffff::2/128&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To start the tunnel run the following command&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;8&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;sudo wg-quick up wg0&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Client Configuration&lt;/h2&gt;
&lt;p&gt;Here we are allowing a single IPv6 address. If the server config is allowing a large subnet, we can change it accordingly.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;9&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Address = 10.66.66.2, 2001:db8::ffaa:87dd:ffff::2/128&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Below is the full config. Save the file in &lt;code class=&quot;language-text&quot;&gt;/etc/wireguard/client1.conf&lt;/code&gt;&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;10&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;[Interface]&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;PrivateKey =&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Address = 10.66.66.2, 2001:db8::ffaa:87dd:ffff::2/128&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;DNS =  2606:4700:4700::1001&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;[Peer]&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;PublicKey =&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;#PresharedKey =&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;AllowedIPs = 0.0.0.0/0, ::/0&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Endpoint = [2001:db8::ffaa:87dd::123]:60002&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To start the tunnel run the following command in linux.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;11&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;sudo wg-quick up wg0&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Testing&lt;/h2&gt;
&lt;p&gt;After setting up the VPN you can test the connetion by going to test-ipv6.com&lt;/p&gt;
&lt;p&gt;You can see that the IPv6 address is preferred over the IPv4 address.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174218.96857872734/a80b8/wg-ipv6.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.53164556962025%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABG3AAARtwGaY1MrAAACCklEQVR42m1SyY7UMBTMt3NC4g9ampkPQOKMEHAYDiya6Qaa4TBcuoekO5vtxI63bMWzQ+cCjkq2HLte1SsnRVEgL3JUvIJoBJqmQdu2K1jNULMaaZGi4MU/4ILHc4GHMYbEGY9MnvD2+B6VqRHGNE2Y5zmi72dkLMPV9grX2+tl3l3jZneDzf0GB35Abz3KqozESZEX0NaiYFRJShhjMBLhZRg/kgqBNM9QCwbZSprr6CigaRtIuhfUCVKbLCp6siqogoQge1a1K2E/TpBKouUNmOb4cvoM21uM44h5mmmeMNHaup4EKSShZ53sMNgRWhsibaAIYa21jjaUUrSnIEyD2/QW+2oPNzhgpvbMS3uGWLhDwhnZKX/jx3mPuq3hrFvJAgQV5JxHdHTBdz7aDkIuiOGRM0FnEqupf7rGu8MHnCWD7wE/jKtl249RYUi7ait8PH2CdDKqG6dxCZDg/LBYDoRnneOhfiDpWNNdCelgpzs01MOCCF8f30B6Gf/N8bv0el4sO+3wpI74Vu3wvxEUBkuCM2qHRKlSKqDoNVg4ehGzd5i8W/udtBSIaZ4o3Uf0ZLV3ZmH6qzJapmdR1AJ3v3LcPZYouYS3GmUjsc0Yvp95VCcDoXMWloIwFISSLTpKODwj7xy891C0P5CClHV4/mqHZy/vcSgXy4fW4MXXDJufOQwV1l2HP1MzRCnh1rjLAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Wireguard IPv6&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174218.96857872734/f058b/wg-ipv6.png&quot;
        srcset=&quot;/static/1772291174218.96857872734/c26ae/wg-ipv6.png 158w,
/static/1772291174218.96857872734/6bdcf/wg-ipv6.png 315w,
/static/1772291174218.96857872734/f058b/wg-ipv6.png 630w,
/static/1772291174218.96857872734/40601/wg-ipv6.png 945w,
/static/1772291174218.96857872734/78612/wg-ipv6.png 1260w,
/static/1772291174218.96857872734/a80b8/wg-ipv6.png 1497w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Enabling IPv6 on Java and Maven]]></title><description><![CDATA[With IPv6 adoption being increased due to IPv4 scarcity and more providers like AWS and Hetzner moving on to IPv6 only networks, it is‚Ä¶]]></description><link>https://blog.miyuru.lk/enabling-ipv6-on-maven-java/</link><guid isPermaLink="false">https://blog.miyuru.lk/enabling-ipv6-on-maven-java/</guid><pubDate>Mon, 29 Nov 2021 22:49:00 GMT</pubDate><content:encoded>&lt;p&gt;With IPv6 adoption being increased due to IPv4 scarcity and more providers like AWS and Hetzner moving on to IPv6 only networks, it is important to know that your app supports and uses the IPv6.&lt;/p&gt;
&lt;p&gt;Java as it turns out comes out of the box with IPv6 disabled. Here are some steps that you can follow to enable IPv6 on you java app.&lt;/p&gt;
&lt;h1&gt;Maven&lt;/h1&gt;
&lt;p&gt;Maven which is heavily used to build java projects needs a few steps to enable IPv6.
The default maven repo does not support IPv6 &lt;a href=&quot;https://issues.apache.org/jira/browse/INFRA-22061&quot;&gt;yet&lt;/a&gt;.  However you can use IPv6 enabled repo &lt;em&gt;ipv6.repo1.maven.org&lt;/em&gt; instead.&lt;/p&gt;
&lt;p&gt;Open &lt;code class=&quot;language-text&quot;&gt;~.m2/settings.xml&lt;/code&gt; and add the following to change the default central repo.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;xml&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &amp;lt;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;mirrors&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &amp;lt;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;mirror&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &amp;lt;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;maven-ipv6&amp;lt;/&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &amp;lt;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;IPv6 Mirror Repository&amp;lt;/&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &amp;lt;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;https://ipv6.repo1.maven.org/maven2&amp;lt;/&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &amp;lt;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;mirrorOf&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;central&amp;lt;/&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;mirrorOf&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &amp;lt;/&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;mirror&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &amp;lt;/&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;mirrors&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and when running mvn command append the following to use IPv6.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;-Djava.net.preferIPv6Addresses=true&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;Java&lt;/h1&gt;
&lt;p&gt;For Java Applications you can enable IPv6 by adding &lt;code class=&quot;language-text&quot;&gt;-Djava.net.preferIPv6Addresses=true&lt;/code&gt; when running for a command line as with maven.&lt;/p&gt;
&lt;p&gt;Or add the &lt;code class=&quot;language-text&quot;&gt;preferIPv6Addresses&lt;/code&gt; on the system property in the app itself.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;java&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;System.&lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;setProperty&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;java.net.preferIPv6Addresses&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This will make the application use IPv6 when available.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk7 { color: #225588; }
  .abyss .mtk6 { color: #DDBB88; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Using IPv6 to serve github pages on custom domains]]></title><description><![CDATA[New IPv4 and IPv6 address for Github Pages are as below. SSL are working on these IPv6 addresses‚Ä¶]]></description><link>https://blog.miyuru.lk/using-ipv6-to-github-pages-on-custom-domains/</link><guid isPermaLink="false">https://blog.miyuru.lk/using-ipv6-to-github-pages-on-custom-domains/</guid><pubDate>Sat, 14 Aug 2021 23:00:00 GMT</pubDate><content:encoded>&lt;p&gt;New IPv4 and IPv6 address for Github Pages are as below. &lt;strong&gt;SSL are working on these IPv6 addresses.&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;185.199.108.153  - &amp;gt;  2606:50c0:8000::153&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;185.199.109.153  - &amp;gt;  2606:50c0:8001::153&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;185.199.110.153  - &amp;gt;  2606:50c0:8002::153&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;185.199.111.153  - &amp;gt;  2606:50c0:8003::153&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;=============================================&lt;/p&gt;
&lt;p&gt;&lt;em&gt;2019-04-23 - Original Post&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Even though currently github pages does not support IPv6, their CDN fastly does.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;‚ö†Ô∏èPlease do this only If you know what you are doing! This IP can change at any moment.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;To add IPv6 support, add a AAAA reccord in your DNS with the following IPv6 address.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;2a04:4e42::133&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This IP is the anycasted IPv6 address of Fasly CDN which serves Github Pages. &lt;strong&gt;It is recommended to use this with Cloudflare Proxy as HTTPS does not work with custom domains with this IP&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;In fact this blog is powered with IPv6 Github Pages.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174218.96857872736/8802b/cf-blog-github.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 5.063291139240507%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABGvAAARrwH3/UuEAAAAQ0lEQVR42jXKwQmAQAxEUfvvzC4swJAQ1zGbCCMb8PAvj78BoLszIpiZXVVxuZlRVSkiHPdo/5/1t+PhvE7i2Dnr5QdCMU1BrKpFBAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Cloudflare IPv6 GitHub Pages&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174218.96857872736/f058b/cf-blog-github.png&quot;
        srcset=&quot;/static/1772291174218.96857872736/c26ae/cf-blog-github.png 158w,
/static/1772291174218.96857872736/6bdcf/cf-blog-github.png 315w,
/static/1772291174218.96857872736/f058b/cf-blog-github.png 630w,
/static/1772291174218.96857872736/40601/cf-blog-github.png 945w,
/static/1772291174218.96857872736/8802b/cf-blog-github.png 1135w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Creating CloudWatch Alarms using Terraform CDK (Part 2)]]></title><description><![CDATA[üíâ Find part 1 of the article here. https://blog.miyuru.lk/cw-alarms-using-tfcdk-1/ In this post, let‚Äôs spice things up using loops and boto‚Ä¶]]></description><link>https://blog.miyuru.lk/cw-alarms-using-tfcdk-2/</link><guid isPermaLink="false">https://blog.miyuru.lk/cw-alarms-using-tfcdk-2/</guid><pubDate>Sun, 01 Aug 2021 19:11:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;üíâ Find part 1 of the article here. &lt;a href=&quot;https://blog.miyuru.lk/cw-alarms-using-tfcdk-1/&quot;&gt;https://blog.miyuru.lk/cw-alarms-using-tfcdk-1/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In this post, let‚Äôs spice things up using loops and boto3.&lt;/p&gt;
&lt;p&gt;Let‚Äôs say you need to define multiple alarms with different thresholds.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;python&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; constructs &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; Construct&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; cdktf &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; TerraformStack&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; imports.aws &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; AwsProvider, CloudwatchMetricAlarm&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;thresholds &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; [&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;75&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;85&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;95&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;99&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;evaluation_periods &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;period &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;60&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;statistic &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;Average&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;comparison_operator &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;GreaterThanOrEqualToThreshold&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;metric_name &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;CPUUtilization&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;namespace &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;AWS/EC2&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; threshold_values &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; thresholds:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    insid &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;i-000123456789&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    dimensions&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;dict&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;InstanceId&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;insid)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    threshold &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; threshold_values&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    alarm_name &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;CPU-Utilization-Test-Alarm-&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(threshold_values)&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;%&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    alarm_description &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;This metric monitors EC2 &amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(threshold_values)&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot; CPU utilization&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    CloudwatchMetricAlarm(self, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;Alarm&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_name, &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This code will create 4 alarms that will trigger at 4 trigger points. If you need to add more trigger points its easy as adding value to the array.&lt;/p&gt;
&lt;p&gt;Now if you want to create an alarm for instances in an autoscale group or using tags, we can use boto3 to get the data.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;python&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; constructs &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; Construct&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; cdktf &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; TerraformStack&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; imports.aws &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; AwsProvider, CloudwatchMetricAlarm&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; boto3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;region &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;eu-west-1&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;profile &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;#change this&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;ec2 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; boto3.client(&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;ec2&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;region_name&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;region, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;endpoint_url&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;https://api.ec2.&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;.aws&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;boto3.setup_default_session(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;profile_name&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;profile)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;thresholds &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; [&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;75&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;85&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;95&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;99&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;evaluation_periods &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;period &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;60&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;statistic &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;Average&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;comparison_operator &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;GreaterThanOrEqualToThreshold&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;metric_name &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;CPUUtilization&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;namespace &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;AWS/EC2&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;asg_group_name &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;test-asg&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;response &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; ec2.describe_instances(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;Filters&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;[{&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Name&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;instance-state-name&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Values&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: [&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;running&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]},{&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Name&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;tag:aws:autoscaling:groupName&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Values&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: [asg_group_name]}])&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; res &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; response[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Reservations&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; ins &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; res[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Instances&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        insid&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;ins[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;InstanceId&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; (insid)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; threshold_values &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; thresholds:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;            dimensions &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;dict&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;InstanceId&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;insid)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;            threshold &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; threshold_values&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;            alarm_name &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;CPU-Utilization-Test-Alarm-&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(threshold_values)&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;%&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;            alarm_description &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;This metric monitors EC2 CPU utilization&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;            CloudwatchMetricAlarm(self, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;Alarm&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_name, &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This code will call the autoscaling API, get the instance IDs and create alarms for each instance with different thresholds.&lt;/p&gt;
&lt;p&gt;Here is the completed code.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;python&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; constructs &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; Construct&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; cdktf &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; App, TerraformStack&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; imports.aws &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; AwsProvider, CloudwatchMetricAlarm&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; boto3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;region &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;eu-west-1&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;profile &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;#change this&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;boto3.setup_default_session(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;profile_name&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;profile)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;ec2 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; boto3.client(&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;ec2&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;region_name&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;region, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;endpoint_url&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;https://api.ec2.&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;.aws&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;thresholds &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; [&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;75&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;85&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;95&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;99&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;evaluation_periods &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;period &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;60&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;statistic &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;Average&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;comparison_operator &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;GreaterThanOrEqualToThreshold&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;metric_name &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;CPUUtilization&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;namespace &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;AWS/EC2&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;asg_group_name &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;test-asg&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;#change this&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_actions &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; []&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk5 mtku&quot;&gt;MyStack&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk6 mtki mtku&quot;&gt;TerraformStack&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;):&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: Construct, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;ns&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;):&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(scope, ns)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    AwsProvider(self, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Aws&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;region, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;profile)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    response &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; ec2.describe_instances(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;Filters&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;[{&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Name&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;tag:aws:autoscaling:groupName&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Values&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: [asg_group_name]},{&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Name&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;instance-state-name&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Values&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: [&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;running&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]}])&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; res &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; response[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Reservations&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; ins &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; res[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Instances&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        insid&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;ins[&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;InstanceId&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; (insid)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; threshold_values &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; thresholds:&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          dimensions&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;dict&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;InstanceId&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;insid)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          threshold &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; threshold_values&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          alarm_name &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;CPU-Utilization-Test-Alarm-&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(threshold_values)&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;%&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          alarm_description &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;This metric monitors EC2 CPU utilization&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;          CloudwatchMetricAlarm(self, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;Test Alarm-&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_name&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;-&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;insid, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;alarm_name&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_name, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;comparison_operator&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;comparison_operator, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;evaluation_periods&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;evaluation_periods, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;dimensions&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;dimensions, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;metric_name&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;metric_name, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;namespace, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;period, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;statistic&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;statistic, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;threshold&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;threshold, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;alarm_description&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_description, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;alarm_actions&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_actions)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;app &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; App()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;MyStack(app, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;cdkalarms&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;app.synth()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;üëâ Remember to create an auto scaling group and change the variables accordingly.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;To deploy the it, run&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;3&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;cdktf deploy&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The alarms should be now created.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174211.63627872569/2bef9/cdktf_alarms_created.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.9620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABGvAAARrwH3/UuEAAABtUlEQVR42lWTyZbcIAxF/U856SxSLozNjDFVLk/Vq87/f8SLkIekF+8ISyBdCVzZQcPPDmp0aJ8Rtcv4UXv8bHpSZH3Q+oO/i8Lhp7WIuCmPW2dRk/0lFKp1XjA9J6SYEHxEzgPG5wNtK1HXv9GIO+73G4Sov6k57P1e4oKtEALV+Brx9ecLyzIjxIC+71mv14TXNO2WFEKAsRbee1iyxuwqa3v4lSJCKSWcc+zsyNG2LQeXhcgp4TzPWNeVE5Z9ReXgKa31ZbuuQ2Ws4UPjOPLmcrAQliSntm1jn6NCnuJMeJAxDOkiLFlL4KykyJbg4/HEMAxIaSCbOYExhvdI2XIn/9SxLd1W2mhujwkpUYiRaBLmZWWVWKGM5HcHyUlXurPOMqHzgYppVG3XXpULbdcpPpjzgwmLcs57Fxeh/K6DdCfUCsu60I2+uHqZUUoJ7/ebZ7euGzZax9jvM47hutlrhva/GSrqX8kOUkiWqGsYKpL6SO/SIQZPIyjttERPJLLht3lKNAJN01yq0koP+tPTX9LCTTSXlBGGDS4tUH6EJ2v7BY3OEF2/Sw2s4tPa8IM+E/4F4bGUv5aUJTMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Terminal CDKTF Alarm&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174211.63627872569/f058b/cdktf_alarms_created.png&quot;
        srcset=&quot;/static/1772291174211.63627872569/c26ae/cdktf_alarms_created.png 158w,
/static/1772291174211.63627872569/6bdcf/cdktf_alarms_created.png 315w,
/static/1772291174211.63627872569/f058b/cdktf_alarms_created.png 630w,
/static/1772291174211.63627872569/40601/cdktf_alarms_created.png 945w,
/static/1772291174211.63627872569/2bef9/cdktf_alarms_created.png 1024w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
You can view it the console as well.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174209.6367872568/098c1/aws_alarms.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.177215189873415%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABGvAAARrwH3/UuEAAABO0lEQVR42j2RW3KsMAxE2f8CsptbWUEqX/c3qVR4e5gBZFt+MHQkTTJQqsZgHTXtpndXuOWGfd8RQrAiIltrkfdWXmrTtX7/Ld3rI4NcC/p4A42faJxz2LYNx3Gg1mqVEj+BOWfkUkQLmBleYV5gMRqQ6wn+ege9voD+/0Ojm9SRNipMVZtUdYg2rTIwpYQokOV6NfAfPMt74oQMINUDTREIccYtZOxckModPpFogl4hRNzWFVEACr9cLniY8NjNSJE4CCUzzrsA1VXMB9ZYBJjBAuQSkWs2oDZrYxLHBlzEobjy4ZFtkTjUuRo75W70tzQHEmgQmIhYZ9R7MaDmpyAdrOqeDskGFcv3Ec95CnCRid0443uY0A4zhsmhn3qM8yhuFgzjiLbrTO257TBN03M9y6F2fW+D9KB+ALgAGwTkoOB8AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Terminal CDKTF Alarm&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174209.6367872568/f058b/aws_alarms.png&quot;
        srcset=&quot;/static/1772291174209.6367872568/c26ae/aws_alarms.png 158w,
/static/1772291174209.6367872568/6bdcf/aws_alarms.png 315w,
/static/1772291174209.6367872568/f058b/aws_alarms.png 630w,
/static/1772291174209.6367872568/40601/aws_alarms.png 945w,
/static/1772291174209.6367872568/78612/aws_alarms.png 1260w,
/static/1772291174209.6367872568/098c1/aws_alarms.png 1578w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;To delete the test alarms, run&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;4&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;cdktf destroy&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The documentation and stackoverflow answers for Terraform CDK is non existent at the moment. So if an error occurs, it might be hard to track it down. Search the github issues if you encounter problem. &lt;a href=&quot;https://github.com/hashicorp/terraform-cdk/issues&quot;&gt;https://github.com/hashicorp/terraform-cdk/issues&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;From this post, you can see how Terraform CDK can help you easily manage terraform code.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtku {
    text-decoration: underline;
    text-underline-position: under;
  }
  .abyss .mtki { font-style: italic; }
  .abyss .mtk3 { color: #384887; }
  .abyss .mtk7 { color: #225588; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk4 { color: #F280D0; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .mtk15 { color: #9966B8; }
  .abyss .mtk19 { color: #2277FF; }
  .abyss .mtk5 { color: #FFEEBB; }
  .abyss .mtk6 { color: #DDBB88; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Creating CloudWatch Alarms using Terraform CDK (Part 1)]]></title><description><![CDATA[In this post, I will show how to use Terraform CDK to create and manage cloudwatch alarms. There are multiple benefits of using cdktf‚Ä¶]]></description><link>https://blog.miyuru.lk/cw-alarms-using-tfcdk-1/</link><guid isPermaLink="false">https://blog.miyuru.lk/cw-alarms-using-tfcdk-1/</guid><pubDate>Sun, 25 Jul 2021 19:11:00 GMT</pubDate><content:encoded>&lt;p&gt;In this post, I will show how to use Terraform CDK to create and manage cloudwatch alarms.&lt;/p&gt;
&lt;p&gt;There are multiple benefits of using cdktf instead of plain terraform files.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;When there are lot alarms, the tf file can get large.&lt;/li&gt;
&lt;li&gt;Using tf loops to create multiple alarms is not easy to manage.&lt;/li&gt;
&lt;li&gt;Adding a new component to alarms gets harder. (Eg: New disk alarms)&lt;/li&gt;
&lt;li&gt;Can setup to automally add alarms to resources. (Eg: autoscaled instances)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;First, if you don‚Äôt know or havent install cdktf, use the tutorial from hashicorp to setup your environment and get familiar. &lt;a href=&quot;https://learn.hashicorp.com/tutorials/terraform/cdktf-build-python?in=terraform/cdktf&quot;&gt;https://learn.hashicorp.com/tutorials/terraform/cdktf-build-python?in=terraform/cdktf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;What cdktf does is, it creates the tf files programmatically and then run the tf files using terraform as usual. So its better to choose the programming language that is most familiar to you. I will be using python.&lt;/p&gt;
&lt;p&gt;First let‚Äôs create a alarm. Be sure to fill in the variables.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;python&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; constructs &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; Construct&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; cdktf &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; App, TerraformStack&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; imports.aws &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; AwsProvider, CloudwatchMetricAlarm&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;region &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;eu-west-1&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;profile &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;#change this&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;insid &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;i-000123456789&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;dimensions&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;dict&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;InstanceId&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;insid)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_name &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;CPU-Utilization-Test-Alarm&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;metric_name &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;CPUUtilization&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;namespace &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;AWS/EC2&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;threshold &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;75&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_description &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;This metric monitors EC2 CPU utilization&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;evaluation_periods &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;period &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;60&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;statistic &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;Average&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;comparison_operator &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;GreaterThanOrEqualToThreshold&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_actions &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; []&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk5 mtku&quot;&gt;MyStack&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk6 mtki mtku&quot;&gt;TerraformStack&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;):&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;def&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: Construct, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;ns&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;):&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(scope, ns)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        AwsProvider(self, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;Aws&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;region, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;profile)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;        CloudwatchMetricAlarm(self, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;Test Alarm&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;alarm_name&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_name, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;comparison_operator&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;comparison_operator, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;evaluation_periods&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;evaluation_periods, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;dimensions&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;dimensions, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;metric_name&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;metric_name, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;namespace, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;period, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;statistic&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;statistic, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;threshold&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;threshold, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;alarm_description&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_description, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;alarm_actions&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;alarm_actions)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;app &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; App()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;MyStack(app, &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;cdkalarms&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;app.synth()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You  may have noticed that I have created variables in the function itself and passing them via keyword arguments with the same keyword. This will come in handy when changing data or when creating multiple alarms in loops.&lt;/p&gt;
&lt;p&gt;To deploy the it, run&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;cdktf deploy&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The alarm should be now created.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174209.2427872565/dc616/cdktf_alarm_created.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 18.9873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABGvAAARrwH3/UuEAAAAy0lEQVR42lXO62rEIBAF4DxYWMfxErNG3STuWhoWWrr0/d/gdAyl0B8fM3L04JC+FvjDg6vGvG/Y2jdCOTCaFRdXoaa7aCB/F7uooKmeZw4PXJeCUrIoiDFieH2+8NbekfKKmDLSrSBIMC8LtLUYFeFCBGMYzhl4Z3+ngbUsjGR9t2BmDL25SBnzBG2cYCEXvAfJHElJoZJcy0MN+w/9lXV9H67HDJUVQgvwa4aPD+T9CRsb5tuBVD/OqWySHwvXFZDgaYPzAVqT0Kcftu6TiceTrL8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Terminal CDKTF Alarm&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174209.2427872565/f058b/cdktf_alarm_created.png&quot;
        srcset=&quot;/static/1772291174209.2427872565/c26ae/cdktf_alarm_created.png 158w,
/static/1772291174209.2427872565/6bdcf/cdktf_alarm_created.png 315w,
/static/1772291174209.2427872565/f058b/cdktf_alarm_created.png 630w,
/static/1772291174209.2427872565/dc616/cdktf_alarm_created.png 933w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
You can view it the console as well.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174208.66677872564/c655d/aws_alarm.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 22.78481012658228%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABGvAAARrwH3/UuEAAAA2ElEQVR42j1QCW7EIAzk/f1KX9A/9Be7agItSbjMkUiztkkXaeSxPR4D5sd5bNuOmDJSnggx4ghBo+QxpTf+NcpLeefJr0i/TxjvPXofGOPGeSKz4AiHGkqttobWO3IhFCI1yjQ53b3y/Yn09QFDterQyUZi1vrk13Whc73xgC6UHudEFYUNpZc5Vp4Xj8464twk3upjQaCG0sa83RFUKHxZLf74FeMcWJYF+76rgX4HP1uWeb/x4g45xjqHVWAtrBM4WDuju6Gca4/HkxesqpUoEK27PUT3AghZfrGKv1RNAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Terminal CDKTF Alarm&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174208.66677872564/f058b/aws_alarm.png&quot;
        srcset=&quot;/static/1772291174208.66677872564/c26ae/aws_alarm.png 158w,
/static/1772291174208.66677872564/6bdcf/aws_alarm.png 315w,
/static/1772291174208.66677872564/f058b/aws_alarm.png 630w,
/static/1772291174208.66677872564/40601/aws_alarm.png 945w,
/static/1772291174208.66677872564/78612/aws_alarm.png 1260w,
/static/1772291174208.66677872564/c655d/aws_alarm.png 1586w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;To delete the test alarm, run&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;cdktf destroy&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the next post, let‚Äôs look at how to create multiple alarms easily and dynamically.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üíâ Find part 2 of the article here. &lt;a href=&quot;https://blog.miyuru.lk/cw-alarms-using-tfcdk-2/&quot;&gt;https://blog.miyuru.lk/cw-alarms-using-tfcdk-2/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtku {
    text-decoration: underline;
    text-underline-position: under;
  }
  .abyss .mtki { font-style: italic; }
  .abyss .mtk3 { color: #384887; }
  .abyss .mtk7 { color: #225588; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .mtk15 { color: #9966B8; }
  .abyss .mtk19 { color: #2277FF; }
  .abyss .mtk4 { color: #F280D0; }
  .abyss .mtk5 { color: #FFEEBB; }
  .abyss .mtk6 { color: #DDBB88; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[AWS 1GB Debian AMI]]></title><description><![CDATA[Update 2022: You can also use alpinelinux AMI image which is also 1GB in size.  https://alpinelinux.org/cloud/ Linux AMIs from AWS are‚Ä¶]]></description><link>https://blog.miyuru.lk/aws-root-volume/</link><guid isPermaLink="false">https://blog.miyuru.lk/aws-root-volume/</guid><pubDate>Fri, 01 Jan 2021 23:11:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;Update 2022: You can also use alpinelinux AMI image which is also 1GB in size.  &lt;a href=&quot;https://alpinelinux.org/cloud/&quot;&gt;https://alpinelinux.org/cloud/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Linux AMIs from AWS are typically are 8GB in size. This leaves around 80% disk space unused if there are not much software is installed and if the data is another volume.&lt;/p&gt;
&lt;p&gt;There are some advantages creating a smaller root volume.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Lower cost. GP3 volumes are cheaper now, but it saves money if there are lot of instances.&lt;/li&gt;
&lt;li&gt;Faster AMI creation.&lt;/li&gt;
&lt;li&gt;You can always increase size of the root volume when needed, but decreasing the size is not possible.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To do this I tried several methods.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Simply rysnc another snapshot does not work. how ever this can work for non root volume with data.&lt;/li&gt;
&lt;li&gt;dd copy or manually creating the file system and copying the files failed with file system error on boot.&lt;/li&gt;
&lt;li&gt;Creating a raw image manually.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Unfortunately it is not easy to do, only way I found that worked was creating image using fai. Even then, there are configurations that needs to be created.&lt;/p&gt;
&lt;p&gt;Fortunately the debian team uses fai to create the aws images and shares the code they use to create them on their git repo. &lt;a href=&quot;https://salsa.debian.org/zmarano-guest/debian-cloud-images/-/tree/master&quot;&gt;https://salsa.debian.org/zmarano-guest/debian-cloud-images/-/tree/master&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;First setup a instance with debian buster AMI, make sure to use x64 one.&lt;/p&gt;
&lt;p&gt;Or use the following terraform script to create the setup that I used. It will create a t3a.nano spot instance with a empty 1GB volume.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;json&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;provider &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;aws&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;eu-central-1&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;#change&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;the&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;region&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;#add&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;your&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;name&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;resource &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;aws_spot_instance_request&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;fai_server&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;ami&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;                    &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;data.aws_ami.debian_buser.id&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;instance_type&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;t3a.nano&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;spot_price&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;             &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;0.0016&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;#check&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;the&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;price&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;you&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;run&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;availability_zone&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;data.aws_availability_zones.available.names[1]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;key_name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;               &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;#add&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;your&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;name&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;spot_type&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;one-time&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;wait_for_fulfillment&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;   &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;resource &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;aws_ebs_volume&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;ami_volume&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;availability_zone&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;aws_spot_instance_request.fai_server.availability_zone&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;gp3&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;{&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;1gb-ami&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  }&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;resource &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;aws_volume_attachment&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;ebs_attach_ami_vol&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;device_name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;/dev/xvdf&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;volume_id&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;   &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;aws_ebs_volume.ami_volume.id&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;instance_id&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;aws_spot_instance_request.fai_server.spot_instance_id&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;data &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;aws_ami&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;debian_buster&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;most_recent&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;owners&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;136693071363&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;{&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;   &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;debian-10-amd64-*-*&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  }&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;data &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;aws_availability_zones&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;available&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; {&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk8&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;&amp;quot;available&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;First update the apt cache&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo apt update&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Install fai server and the required tools&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo apt install fai-server fai-setup-storage dosfstools&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Get the config space configuration the debian team is using&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;3&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;wget https://salsa.debian.org/zmarano-guest/debian-cloud-images/-/archive/master/debian-cloud-images-master.tar.gz&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;path=config_space -O debian-cloud-images-master.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;unzip the tar file&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;4&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;tar -xzf debian-cloud-images-master.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the debain teams configuration, there are some files that we don‚Äôt need. We need to remove them or the process will fail.&lt;/p&gt;
&lt;p&gt;remove the following files&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;5&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;rm debian-cloud-images-master-config_space/config_space/hooks/tests.CLOUD&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;rm debian-cloud-images-master-config_space/config_space/scripts/LAST/30-manifest&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;rm debian-cloud-images-master-config_space/config_space/scripts/LAST/40-info&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then run the following command to create the the image.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;6&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo /usr/sbin/fai-diskimage --verbose --hostname debian --class DEBIAN,CLOUD,TYPE_DEV,BUSTER,EC2,IPV6_DHCP,AMD64,GRUB_CLOUD_AMD64,LINUX_IMAGE_CLOUD,LAST --size 1G --cspace /home/admin/debian-cloud-images-master-config_space/config_space image_buster_ec2_amd64.raw&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To find more info about the above command see &lt;a href=&quot;https://salsa.debian.org/zmarano-guest/debian-cloud-images/-/blob/master/doc/details.md&quot;&gt;https://salsa.debian.org/zmarano-guest/debian-cloud-images/-/blob/master/doc/details.md&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;if successful you will get a .raw file and a notice that it was successfully created&lt;/p&gt;
&lt;p&gt;Now dd copy the raw file to the empty volume.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;7&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo dd if=image_buster_ec2_amd64.raw of=/dev/nvme1n1 bs=512k&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;check the file system of the volume&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;8&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo partx --show /dev/nvme1n1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now create a snapshot and register a AMI from the 1GB volume.
Launch a instance from the AMI and see if it works.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtki { font-style: italic; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .mtk8 { color: #F8F8F0; }
  .abyss .mtk15 { color: #9966B8; }
  .abyss .mtk7 { color: #225588; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[How to Install Consul on Debain 10]]></title><description><![CDATA[In this tutorial, we will be installing Consul on Debian 10 buster in a single node. First cd to temp folder Install the necessary packages‚Ä¶]]></description><link>https://blog.miyuru.lk/how-to-install-consul-on-debain-10/</link><guid isPermaLink="false">https://blog.miyuru.lk/how-to-install-consul-on-debain-10/</guid><pubDate>Sat, 14 Nov 2020 18:00:19 GMT</pubDate><content:encoded>&lt;p&gt;In this tutorial, we will be installing Consul on Debian 10 buster in a single node.&lt;/p&gt;
&lt;p&gt;First cd to temp folder&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15&quot;&gt;cd&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; /tmp&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Install the necessary packages.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo apt install curl jq unzip&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;Please note checkpoint-api.hashicorp.com is a IPv4 only endpoint at the time of the writing.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;To install the latest version use the following commands. It will check the system architecture as well.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;consul_version=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;`curl https://checkpoint-api.hashicorp.com/v1/check/consul &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; jq .current_version &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;  tr -d &amp;#39;&amp;quot;&amp;#39;`&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;system_arch=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;`uname -m &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; grep -q &amp;#39;x86_64&amp;#39; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;echo&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; &amp;#39;amd64&amp;#39; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;||&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;echo&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt; &amp;quot;arm64&amp;quot;`&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;curl &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;quot;https://releases.hashicorp.com/consul/${consul_version}/consul_${consul_version}_linux_${system_arch}.zip&amp;quot;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; consul.zip&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;unzip the consul zip.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;3&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;unzip consul.zip&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Move the file to local bin, so it can accessed at any path and add the executable permission.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;4&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo cp consul /usr/local/bin/&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo chmod +x /usr/local/bin/consul&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;check if the consul is working by checking the version.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;5&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;consul --version&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If the all is well you should see a output like below.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;output&quot; data-index=&quot;6&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Consul v1.8.4&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Revision 12b16df32&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;Protocol 2 spoken by default, understands 2 to 3 (agent will automatically use protocol &amp;gt;2 when speaking to compatible agents)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Start the consul agent in dev mode.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;7&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;consul agent -dev&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;by default the consul UI will run on 8500 port.&lt;/p&gt;
&lt;p&gt;visit &lt;a href=&quot;http://localhost:8500/&quot;&gt;http://localhost:8500/&lt;/a&gt; to view the consul UI.&lt;/p&gt;
&lt;p&gt;You should see output like below with consul services.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174217.88387872590/bb2fd/consul_services.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABC0lEQVR42q2QwU7CQBCG92H0oCEmaIzP4cmDJsIB1JfwGbhykkAoPJEEAhWRwKHtNrTSbrft/u5uAyHQGEQm+TI7szOTmZ90ilXUzu7wWrhF/eIRXRl3rp9hXFXRKpRhXKr4CY3Thx3eTu7RLlZ0XffmBc3zEog/msMzZ3CHU9D+F1zFIPO0N1nHzvs4F9qfwOl96hoqPRmOPzAwTdguRSoEhOQ/RmyLwrIdeJ4PxiLEcbw3QcCwWPiyn8LzlxBpCrLkAaKII5XBX+FxAiZ7g5DpZdR1ZOrOYFm2PvcYRkSObqtcBjbI13j1nw2Eeu0OPHjD7USSJFLgb3DOEUptlPhKY+15hJCxX+X5AezTnZxmYUTCAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Consul Services page&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174217.88387872590/f058b/consul_services.png&quot;
        srcset=&quot;/static/1772291174217.88387872590/c26ae/consul_services.png 158w,
/static/1772291174217.88387872590/6bdcf/consul_services.png 315w,
/static/1772291174217.88387872590/f058b/consul_services.png 630w,
/static/1772291174217.88387872590/40601/consul_services.png 945w,
/static/1772291174217.88387872590/bb2fd/consul_services.png 1058w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Click the nodes in header and you view consul nodes.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1772291174216.63627872589/bb2fd/consul_nodes.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABK0lEQVR42q2R20rDQBCG8zB6IxE8ID6JeKEXClr1SQRfQqlWfSFtm1JpWm0TtUna3cRkD/mdXWoN9MrDwMfyz/4zzOw6N2tHqK8e4nazhgt3F+fuDu62Tq2+dim/USN9gqvl/QUul/bQWD+2vvvtM9RXDuDwpwCsO0LiPWPc6uO97SP2BojbA0TNvj2NHj/0MH5cJDK+FtV0jN+H0+x46Po9CKmgyxJ/DScM3zAKQjDGEcUTJBOOiYUhTqakmc3F9o5ZsixHngtIGsIghARPM2ilaWWegnPTYIq8KCAUGaSEJJOZek5FKyrUukRZfiOpzpzO8GWIMAwREKahiXJGNaq62mjO18qvowABURTCJj5UDibYrMnP39Qx66ZpSmvQp2gNpZXl15+Cf45P62ubv8edZ3sAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Consul Nodes page&quot;
        title=&quot;&quot;
        src=&quot;/static/1772291174216.63627872589/f058b/consul_nodes.png&quot;
        srcset=&quot;/static/1772291174216.63627872589/c26ae/consul_nodes.png 158w,
/static/1772291174216.63627872589/6bdcf/consul_nodes.png 315w,
/static/1772291174216.63627872589/f058b/consul_nodes.png 630w,
/static/1772291174216.63627872589/40601/consul_nodes.png 945w,
/static/1772291174216.63627872589/bb2fd/consul_nodes.png 1058w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;CRTL-C on the terminal to to stop the process.&lt;/p&gt;
&lt;p&gt;You have now successfully setup single consul node.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtk15 { color: #9966B8; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .mtk7 { color: #225588; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Copying AWS Tags using CLI]]></title><description><![CDATA[When a AWS account have large number of resources, tags are used to maintain and group resources.
Normally these tags are added using the‚Ä¶]]></description><link>https://blog.miyuru.lk/copying-aws-tags-using-cli/</link><guid isPermaLink="false">https://blog.miyuru.lk/copying-aws-tags-using-cli/</guid><pubDate>Sat, 11 Apr 2020 17:43:00 GMT</pubDate><content:encoded>&lt;p&gt;When a AWS account have large number of resources, tags are used to maintain and group resources.
Normally these tags are added using the cloud formation templates but some times you need to manually copy them to a another resource. This can be easily done using the AWS CLI.&lt;/p&gt;
&lt;p&gt;The following CLI command queries the tags and saves them to a json file.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;aws ec2 describe-tags --filters Name=resource-id,Values={{ OLD_RESOURCE_ID }} --query &amp;#39;Tags[].{Key:Key,Value:Value}&amp;#39; --profile {{ AWS_PROFILE }} --region us-east-1 --endpoint-url https://api.ec2.us-east-1.aws &amp;gt; tags.json&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The following CLI command takes the exported tags using the json files and adds them to the new resource.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;aws ec2 create-tags --resources {{ NEW_RESOURCE_ID }} --tags file://tags.json --profile {{ AWS_PROFILE }} --region us-east-1 --endpoint-url https://api.ec2.us-east-1.aws&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Hope this helps someone.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[How to Install OpenTracker on Debain 10]]></title><description><![CDATA[In this tutorial, we will be installing open tracker with IPv6 enabled on Debian 10 buster. First install the required packages then create‚Ä¶]]></description><link>https://blog.miyuru.lk/how-to-install-opentracker-on-debain-10/</link><guid isPermaLink="false">https://blog.miyuru.lk/how-to-install-opentracker-on-debain-10/</guid><pubDate>Sat, 08 Feb 2020 19:13:00 GMT</pubDate><content:encoded>&lt;p&gt;In this tutorial, we will be installing open tracker with IPv6 enabled on Debian 10 buster.&lt;/p&gt;
&lt;p&gt;First install the required packages&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo apt install libowfat-dev make git build-essential zlib1g-dev libowfat-dev make git&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;then create a user called opentracker and switch to that user&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo useradd opentracker -m&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;su - opentracker&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;clone the opentracker repo&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;git clone git://erdgeist.org/opentracker&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;go to opentracker directory&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;3&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15&quot;&gt;cd&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; opentracker&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Open the makefile&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;4&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;nano Makefile&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the makefile, uncomment the following&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;to enable IPv6&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&quot;grvsc-container grvsc-has-line-highlighting abyss&quot; data-language=&quot;&quot; data-index=&quot;5&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line grvsc-line-diff grvsc-line-diff-del&quot;&gt;&lt;span class=&quot;grvsc-gutter-pad&quot;&gt;&lt;/span&gt;&lt;span class=&quot;grvsc-gutter grvsc-diff-del&quot; aria-hidden=&quot;true&quot; data-content=&quot;-&quot;&gt;&lt;/span&gt;&lt;span class=&quot;grvsc-source&quot;&gt;#FEATURES+=-DWANT_V6&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line grvsc-line-diff grvsc-line-diff-add&quot;&gt;&lt;span class=&quot;grvsc-gutter-pad&quot;&gt;&lt;/span&gt;&lt;span class=&quot;grvsc-gutter grvsc-diff-add&quot; aria-hidden=&quot;true&quot; data-content=&quot;+&quot;&gt;&lt;/span&gt;&lt;span class=&quot;grvsc-source&quot;&gt;FEATURES+=-DWANT_V6&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;to enable gzip compression&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&quot;grvsc-container grvsc-has-line-highlighting abyss&quot; data-language=&quot;&quot; data-index=&quot;6&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line grvsc-line-diff grvsc-line-diff-del&quot;&gt;&lt;span class=&quot;grvsc-gutter-pad&quot;&gt;&lt;/span&gt;&lt;span class=&quot;grvsc-gutter grvsc-diff-del&quot; aria-hidden=&quot;true&quot; data-content=&quot;-&quot;&gt;&lt;/span&gt;&lt;span class=&quot;grvsc-source&quot;&gt;#FEATURES+=-DWANT_COMPRESSION_GZIP&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line grvsc-line-diff grvsc-line-diff-add&quot;&gt;&lt;span class=&quot;grvsc-gutter-pad&quot;&gt;&lt;/span&gt;&lt;span class=&quot;grvsc-gutter grvsc-diff-add&quot; aria-hidden=&quot;true&quot; data-content=&quot;+&quot;&gt;&lt;/span&gt;&lt;span class=&quot;grvsc-source&quot;&gt;FEATURES+=-DWANT_COMPRESSION_GZIP&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;save the file and run make.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;7&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;make&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;finally run following command to start opentracker in background.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;8&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;./opentracker &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;&amp;amp;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;by default the tracker will run on 6969 port on both UDP and TCP.&lt;/p&gt;
&lt;p&gt;visit &lt;a href=&quot;http://serverIP:6969/stats&quot;&gt;http://serverIP:6969/stats&lt;/a&gt; to view the tracker stats.&lt;/p&gt;
&lt;p&gt;To change default settings, copy the sample opentracker.conf file and edit as needed.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;9&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;cp opentracker.conf.sample opentracker.conf&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;nano opentracker.conf&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Remember to open the port in the firewall for both UDP and TCP if a firewall is in place.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk15 { color: #9966B8; }
  .abyss .mtk7 { color: #225588; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Adding IPv6 Support to S3 in AWS SDK]]></title><description><![CDATA[In this post I am going to show how to enable IPv6 (dual stack) support for Amazon S3 in AWS CLI, AWS PHP SDK, JavaScript SDK, Python SDK‚Ä¶]]></description><link>https://blog.miyuru.lk/adding-ipv6-support-to-s3-in-aws-sdk/</link><guid isPermaLink="false">https://blog.miyuru.lk/adding-ipv6-support-to-s3-in-aws-sdk/</guid><pubDate>Thu, 10 Oct 2019 21:01:00 GMT</pubDate><content:encoded>&lt;p&gt;In this post I am going to show how to enable IPv6 (dual stack) support for Amazon S3 in AWS CLI, AWS PHP SDK, JavaScript SDK, Python SDK (boto3), and Java SDK.&lt;/p&gt;
&lt;p&gt;To enable IPv6 in CLI, enter the following command:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;aws configure &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; default.s3.use_dualstack_endpoint &lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This will enable S3 dual stack endpoints in the CLI.&lt;/p&gt;
&lt;p&gt;To enable IPv6 in PHP, add the dualstack endpoint option to the array:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;php&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;// Enable dualstack endpoint&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;$s3 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; Aws\S3\&lt;/span&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;S3Client&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;([&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;version&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;2006-03-01&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;region&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;eu-west-1&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;use_dual_stack_endpoint&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;]);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To enable IPv6 in JavaScript, add the dualstack option to the configuration:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;js&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk3&quot;&gt;// Enable dualstack endpoint&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; bucket &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk5 mtku&quot;&gt;AWS&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mtk5 mtku&quot;&gt;S3&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;({&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;  useDualstack: &lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;});&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To enable IPv6 in Python (boto3), set the &lt;code class=&quot;language-text&quot;&gt;use_dualstack_endpoint&lt;/code&gt; parameter when creating the client:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;python&quot; data-index=&quot;3&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; boto3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;s3 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; boto3.client(&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;s3&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;region_name&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk11&quot;&gt;&amp;#39;eu-west-1&amp;#39;&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;, &lt;/span&gt;&lt;span class=&quot;mtk19 mtki&quot;&gt;use_dualstack_endpoint&lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To enable IPv6 in Java SDK v2, use the &lt;code class=&quot;language-text&quot;&gt;dualstackEnabled&lt;/code&gt; option in the S3 client builder:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;java&quot; data-index=&quot;4&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;software.amazon.awssdk.services.s3.S3Client&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;software.amazon.awssdk.regions.Region&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk7&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;software.amazon.awssdk.services.s3.S3Configuration&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;S3Configuration&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; s3Config &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; S3Configuration.&lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    .&lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;dualstackEnabled&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    .&lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;();&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk15 mtki&quot;&gt;S3Client&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; s3 &lt;/span&gt;&lt;span class=&quot;mtk7&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt; S3Client.&lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    .&lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(Region.EU_WEST_1)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    .&lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;serviceConfiguration&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;(s3Config)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;    .&lt;/span&gt;&lt;span class=&quot;mtk6&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;mtk1&quot;&gt;();&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtku {
    text-decoration: underline;
    text-underline-position: under;
  }
  .abyss .mtki { font-style: italic; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .mtk15 { color: #9966B8; }
  .abyss .mtk3 { color: #384887; }
  .abyss .mtk7 { color: #225588; }
  .abyss .mtk11 { color: #22AA44; }
  .abyss .mtk4 { color: #F280D0; }
  .abyss .mtk5 { color: #FFEEBB; }
  .abyss .mtk19 { color: #2277FF; }
  .abyss .mtk6 { color: #DDBB88; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Archive.is Cloudflare Fix]]></title><description><![CDATA[It has been reported that archive.is blocks cloudflare DNS due to cloudflare not supporting EDNS. While a quick fix might be to change the‚Ä¶]]></description><link>https://blog.miyuru.lk/archiveis-cloudflare/</link><guid isPermaLink="false">https://blog.miyuru.lk/archiveis-cloudflare/</guid><pubDate>Sat, 27 Jul 2019 01:08:00 GMT</pubDate><content:encoded>&lt;p&gt;It has been &lt;a href=&quot;https://community.cloudflare.com/t/archive-is-error-1001/18227/10?u=miyurusankalpa&quot;&gt;reported&lt;/a&gt; that archive.is blocks cloudflare DNS due to cloudflare not supporting EDNS.&lt;/p&gt;
&lt;p&gt;While a quick fix might be to change the DNS, another way to fix it while keeping the DNS is to change the hosts file.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;‚ö†Ô∏èPlease do this only If you know what you are doing! This IP can change at any moment.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;‚ö†Ô∏èThis method will not works DNS over HTTPS.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Edit the hosts file and add the following entries and you will be able to access archive.is even while using cloudflare DNS.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;2001:41d0:1:8720::1 archive.is&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;91.121.82.32 archive.is&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[NPM IPv6 fix]]></title><description><![CDATA[Error : getaddrinfo ENOTFOUND registry.npmjs.org registry.npmjs.org:443 if you face the above error when trying to install NPM packages on a‚Ä¶]]></description><link>https://blog.miyuru.lk/npm-ipv6-fix/</link><guid isPermaLink="false">https://blog.miyuru.lk/npm-ipv6-fix/</guid><pubDate>Mon, 15 Jul 2019 00:41:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/39592908/error-getaddrinfo-enotfound-registry-npmjs-org-registry-npmjs-org443&quot;&gt;Error : getaddrinfo ENOTFOUND registry.npmjs.org registry.npmjs.org:443&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;if you face the above error when trying to install NPM packages on a IPv6 only connection, add the following to the hosts file.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;‚ö†Ô∏èPlease do this only If you know what you are doing! This IP can change at any moment.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;2606:4700::6810:1123 registry.npmjs.org&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Testing CDNs for best country specific results with different DNS providers]]></title><description><![CDATA[All tests are conducted on IPv4 and from Sri Lanka. (AS18001) Overall Google and OpenDNS, which support EDNS seems the best.]]></description><link>https://blog.miyuru.lk/edns-geo-table-2019/</link><guid isPermaLink="false">https://blog.miyuru.lk/edns-geo-table-2019/</guid><pubDate>Mon, 06 May 2019 22:50:00 GMT</pubDate><content:encoded>&lt;style&gt;
table, th, td {
  border: 1px solid black;
}
&lt;/style&gt;
&lt;table style=&quot;height: 247px;&quot; width=&quot;738&quot;&gt;
&lt;tbody&gt;
&lt;tr style=&quot;height: 65px;&quot;&gt;
&lt;td style=&quot;width: 109.357px; height: 65px;&quot;&gt;&lt;strong&gt;DNS / Site&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;width: 80.9739px; height: 65px;&quot;&gt;&lt;strong&gt;EDNS&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;width: 90.1565px; height: 65px;&quot;&gt;&lt;strong&gt;Akamai&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;width: 86.8174px; height: 65px;&quot;&gt;&lt;strong&gt;Google&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;width: 86.8174px; height: 65px;&quot;&gt;&lt;strong&gt;Netilify&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;width: 70.9565px; height: 65px;&quot;&gt;&lt;strong&gt;Cloudfront&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;width: 79.3044px; height: 65px;&quot;&gt;&lt;strong&gt;Fastly&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;width: 113.53px; height: 65px;&quot;&gt;&lt;strong&gt;BunnyCDN&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style=&quot;height: 46.7391px;&quot;&gt;
&lt;td style=&quot;width: 109.357px; height: 46.7391px;&quot;&gt;&lt;strong&gt;Cloudflare&lt;/strong&gt;&lt;/td&gt;
&lt;td class=&quot;align-center&quot; style=&quot;width: 80.9739px; height: 46.7391px;&quot;&gt;‚ùå¬†&lt;/td&gt;
&lt;td style=&quot;width: 90.1565px; height: 46.7391px;&quot;&gt;France&lt;/td&gt;
&lt;td style=&quot;width: 86.8174px; height: 46.7391px;&quot;&gt;France&lt;/td&gt;
&lt;td style=&quot;width: 86.8174px; height: 46.7391px;&quot;&gt;Germany&lt;/td&gt;
&lt;td style=&quot;width: 70.9565px; height: 46.7391px;&quot;&gt;Italy&lt;/td&gt;
&lt;td style=&quot;width: 79.3044px; height: 46.7391px;&quot;&gt;France¬†&lt;/td&gt;
&lt;td style=&quot;width: 113.53px; height: 46.7391px;&quot;&gt;France¬†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style=&quot;height: 45px;&quot;&gt;
&lt;td style=&quot;width: 109.357px; height: 45px;&quot;&gt;&lt;strong&gt;Google&lt;/strong&gt;&lt;/td&gt;
&lt;td class=&quot;align-center&quot; style=&quot;width: 80.9739px; height: 45px;&quot;&gt;‚úîÔ∏è&lt;/td&gt;
&lt;td style=&quot;width: 90.1565px; height: 45px;&quot;&gt;Sri Lanka&lt;/td&gt;
&lt;td style=&quot;width: 86.8174px; height: 45px;&quot;&gt;India&lt;/td&gt;
&lt;td style=&quot;width: 86.8174px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;td style=&quot;width: 70.9565px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;td style=&quot;width: 79.3044px; height: 45px;&quot;&gt;France¬†&lt;/td&gt;
&lt;td style=&quot;width: 113.53px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style=&quot;height: 45px;&quot;&gt;
&lt;td style=&quot;width: 109.357px; height: 45px;&quot;&gt;&lt;strong&gt;Quad9&lt;/strong&gt;&lt;/td&gt;
&lt;td class=&quot;align-center&quot; style=&quot;width: 80.9739px; height: 45px;&quot;&gt;‚ùå&lt;/td&gt;
&lt;td style=&quot;width: 90.1565px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;td style=&quot;width: 86.8174px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;td style=&quot;width: 86.8174px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;td style=&quot;width: 70.9565px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;td style=&quot;width: 79.3044px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;td style=&quot;width: 113.53px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style=&quot;height: 45px;&quot;&gt;
&lt;td style=&quot;width: 109.357px; height: 45px;&quot;&gt;&lt;strong&gt;OpenDNS&lt;/strong&gt;&lt;/td&gt;
&lt;td class=&quot;align-center&quot; style=&quot;width: 80.9739px; height: 45px;&quot;&gt;‚úîÔ∏è&lt;/td&gt;
&lt;td style=&quot;width: 90.1565px; height: 45px;&quot;&gt;Sri Lanka&lt;/td&gt;
&lt;td style=&quot;width: 86.8174px; height: 45px;&quot;&gt;India&lt;/td&gt;
&lt;td style=&quot;width: 86.8174px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;td style=&quot;width: 70.9565px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;td style=&quot;width: 79.3044px; height: 45px;&quot;&gt;France¬†&lt;/td&gt;
&lt;td style=&quot;width: 113.53px; height: 45px;&quot;&gt;Singapore&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;All tests are conducted on IPv4 and from Sri Lanka. (AS&lt;a href=&quot;https://db-ip.com/as18001&quot;&gt;18001&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;Overall Google and OpenDNS, which support EDNS seems the best.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[HTTP to HTTPS Nginx]]></title><description><![CDATA[There are 2 methods to redirect to https in Nginx 1st method is to create a separate server block for port 80 and redirect all to https. 2nd‚Ä¶]]></description><link>https://blog.miyuru.lk/http-to-https-nginx/</link><guid isPermaLink="false">https://blog.miyuru.lk/http-to-https-nginx/</guid><pubDate>Sat, 06 Apr 2019 21:50:00 GMT</pubDate><content:encoded>&lt;p&gt;There are 2 methods to redirect to https in Nginx&lt;/p&gt;
&lt;p&gt;1st method is to create a separate server block for port 80 and redirect all to https.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;server {&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  listen 80; //ipv4&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  listen [::]:80; //ipv6&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  server_name example.com;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  return 301 https://$host$request_uri;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2nd method is to add a if statement and redirect only if the check is true.&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;if ($scheme = http) {&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  return 301 https://$host$request_uri;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;if you use cloudflare you can use the following statement to redirect traffic to https&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;if ($http_cf_visitor ~ &amp;#39;{&amp;quot;scheme&amp;quot;:&amp;quot;http&amp;quot;}&amp;#39;) {&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;  return 301 https://$host$request_uri;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[How to add nginx geoip module in ubuntu]]></title><description><![CDATA[First add the nginx stable repo: Then run apt update: And get the nginx geoip module: This will download and load the module to /usr/lib‚Ä¶]]></description><link>https://blog.miyuru.lk/how-to-add-nginx-geoip-module-in-ubuntu/</link><guid isPermaLink="false">https://blog.miyuru.lk/how-to-add-nginx-geoip-module-in-ubuntu/</guid><pubDate>Sat, 06 Apr 2019 21:32:00 GMT</pubDate><content:encoded>&lt;p&gt;First add the nginx stable repo:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;0&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo add-apt-repository ppa:nginx/stable&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then run apt update:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;1&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo apt-get update&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And get the nginx geoip module:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;2&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo apt-get install nginx-module-geoip&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This will download and load the module to /usr/lib/nginx/modules&lt;/p&gt;
&lt;p&gt;To load the nginx module, open nginx.conf:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;bash&quot; data-index=&quot;3&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;&lt;span class=&quot;mtk1&quot;&gt;sudo nano /etc/nginx/nginx.conf&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;add add below in the main context:&lt;/p&gt;
&lt;pre class=&quot;grvsc-container abyss&quot; data-language=&quot;&quot; data-index=&quot;4&quot;&gt;&lt;code class=&quot;grvsc-code&quot;&gt;&lt;span class=&quot;grvsc-line&quot;&gt;&lt;span class=&quot;grvsc-source&quot;&gt;load_module &amp;quot;modules/ngx_http_geoip_module.so&amp;quot;;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The module will be loaded, when you reload the configuration or restart nginx.&lt;/p&gt;
&lt;p&gt;_To dynamically ‚Äúunload‚Äù a module, comment out or remove its load_module directive and reload the nginx configuration.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .abyss { background-color: #000c18; }
  .abyss .mtk1 { color: #6688CC; }
  .abyss .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
&lt;/style&gt;</content:encoded></item><item><title><![CDATA[Hello World]]></title><description><![CDATA[Hello all, Welcome to the blog.]]></description><link>https://blog.miyuru.lk/hello-world/</link><guid isPermaLink="false">https://blog.miyuru.lk/hello-world/</guid><pubDate>Thu, 24 Jan 2019 20:54:00 GMT</pubDate><content:encoded>&lt;p&gt;Hello all,&lt;/p&gt;
&lt;p&gt;Welcome to the blog.&lt;/p&gt;
&lt;style class=&quot;grvsc-styles&quot;&gt;
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line &gt; * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: &apos; &apos;;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting &gt; .grvsc-code &gt; .grvsc-line::before {
    content: &apos; &apos;;
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
&lt;/style&gt;</content:encoded></item></channel></rss>