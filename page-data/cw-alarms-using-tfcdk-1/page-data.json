{"componentChunkName":"component---src-templates-blog-post-js","path":"/cw-alarms-using-tfcdk-1/","result":{"data":{"site":{"siteMetadata":{"title":"Miyuru Tech Blog"}},"markdownRemark":{"id":"479aeca2-338f-51e9-bd20-265b1b4b082e","excerpt":"In this post, I will show how to use Terraform CDK to create and manage cloudwatch alarms. There are multiple benefits of using cdktf instead of plain terraformâ€¦","html":"<p>In this post, I will show how to use Terraform CDK to create and manage cloudwatch alarms.</p>\n<p>There are multiple benefits of using cdktf instead of plain terraform files.</p>\n<ul>\n<li>When there are lot alarms, the tf file can get large.</li>\n<li>Using tf loops to create multiple alarms is not easy to manage.</li>\n<li>Adding a new component to alarms gets harder. (Eg: New disk alarms)</li>\n<li>Can setup to automally add alarms to resources. (Eg: autoscaled instances)</li>\n</ul>\n<p>First, if you donâ€™t know or havent install cdktf, use the tutorial from hashicorp to setup your environment and get familiar. <a href=\"https://learn.hashicorp.com/tutorials/terraform/cdktf-build-python?in=terraform/cdktf\">https://learn.hashicorp.com/tutorials/terraform/cdktf-build-python?in=terraform/cdktf</a></p>\n<p>What cdktf does is, it creates the tf files programmatically and then run the tf files using terraform as usual. So its better to choose the programming language that is most familiar to you. I will be using python.</p>\n<p>First letâ€™s create a alarm. Be sure to fill in the variables.</p>\n<pre class=\"grvsc-container abyss\" data-language=\"python\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#!/usr/bin/env python</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">from</span><span class=\"mtk1\"> constructs </span><span class=\"mtk7\">import</span><span class=\"mtk1\"> Construct</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">from</span><span class=\"mtk1\"> cdktf </span><span class=\"mtk7\">import</span><span class=\"mtk1\"> App, TerraformStack</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">from</span><span class=\"mtk1\"> imports.aws </span><span class=\"mtk7\">import</span><span class=\"mtk1\"> AwsProvider, CloudwatchMetricAlarm</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">region </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&quot;eu-west-1&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">profile </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&quot;test&quot;</span><span class=\"mtk1\">  </span><span class=\"mtk3\">#change this</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">insid </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&quot;i-000123456789&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">dimensions</span><span class=\"mtk7\">=</span><span class=\"mtk15 mtki\">dict</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">InstanceId</span><span class=\"mtk7\">=</span><span class=\"mtk1\">insid)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">alarm_name </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&quot;CPU-Utilization-Test-Alarm&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">metric_name </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&quot;CPUUtilization&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">namespace </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&quot;AWS/EC2&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">threshold </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">75</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">alarm_description </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&quot;This metric monitors EC2 CPU utilization&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">evaluation_periods </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">period </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">60</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">statistic </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&quot;Average&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">comparison_operator </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&quot;GreaterThanOrEqualToThreshold&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">alarm_actions </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> []</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15 mtki\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">MyStack</span><span class=\"mtk1\">(</span><span class=\"mtk6 mtki mtku\">TerraformStack</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15 mtki\">def</span><span class=\"mtk1\"> </span><span class=\"mtk15\">__init__</span><span class=\"mtk1\">(</span><span class=\"mtk19 mtki\">self</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">scope</span><span class=\"mtk1\">: Construct, </span><span class=\"mtk19 mtki\">ns</span><span class=\"mtk1\">: </span><span class=\"mtk15 mtki\">str</span><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15 mtki\">super</span><span class=\"mtk1\">().</span><span class=\"mtk15\">__init__</span><span class=\"mtk1\">(scope, ns)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        AwsProvider(self, </span><span class=\"mtk11\">&#39;Aws&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">region</span><span class=\"mtk7\">=</span><span class=\"mtk1\">region, </span><span class=\"mtk19 mtki\">profile</span><span class=\"mtk7\">=</span><span class=\"mtk1\">profile)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        CloudwatchMetricAlarm(self, </span><span class=\"mtk11\">&quot;Test Alarm&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk19 mtki\">alarm_name</span><span class=\"mtk7\">=</span><span class=\"mtk1\">alarm_name, </span><span class=\"mtk19 mtki\">comparison_operator</span><span class=\"mtk7\">=</span><span class=\"mtk1\">comparison_operator, </span><span class=\"mtk19 mtki\">evaluation_periods</span><span class=\"mtk7\">=</span><span class=\"mtk1\">evaluation_periods, </span><span class=\"mtk19 mtki\">dimensions</span><span class=\"mtk7\">=</span><span class=\"mtk1\">dimensions, </span><span class=\"mtk19 mtki\">metric_name</span><span class=\"mtk7\">=</span><span class=\"mtk1\">metric_name, </span><span class=\"mtk19 mtki\">namespace</span><span class=\"mtk7\">=</span><span class=\"mtk1\">namespace, </span><span class=\"mtk19 mtki\">period</span><span class=\"mtk7\">=</span><span class=\"mtk1\">period, </span><span class=\"mtk19 mtki\">statistic</span><span class=\"mtk7\">=</span><span class=\"mtk1\">statistic, </span><span class=\"mtk19 mtki\">threshold</span><span class=\"mtk7\">=</span><span class=\"mtk1\">threshold, </span><span class=\"mtk19 mtki\">alarm_description</span><span class=\"mtk7\">=</span><span class=\"mtk1\">alarm_description, </span><span class=\"mtk19 mtki\">alarm_actions</span><span class=\"mtk7\">=</span><span class=\"mtk1\">alarm_actions)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">app </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> App()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">MyStack(app, </span><span class=\"mtk11\">&quot;cdkalarms&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">app.synth()</span></span></span></code></pre>\n<p>You  may have noticed that I have created variables in the function itself and passing them via keyword arguments with the same keyword. This will come in handy when changing data or when creating multiple alarms in loops.</p>\n<p>To deploy the it, run</p>\n<pre class=\"grvsc-container abyss\" data-language=\"bash\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">cdktf deploy</span></span></span></code></pre>\n<p>The alarm should be now created.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1772291174209.2427872565/dc616/cdktf_alarm_created.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.9873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABGvAAARrwH3/UuEAAAAy0lEQVR42lXO62rEIBAF4DxYWMfxErNG3STuWhoWWrr0/d/gdAyl0B8fM3L04JC+FvjDg6vGvG/Y2jdCOTCaFRdXoaa7aCB/F7uooKmeZw4PXJeCUrIoiDFieH2+8NbekfKKmDLSrSBIMC8LtLUYFeFCBGMYzhl4Z3+ngbUsjGR9t2BmDL25SBnzBG2cYCEXvAfJHElJoZJcy0MN+w/9lXV9H67HDJUVQgvwa4aPD+T9CRsb5tuBVD/OqWySHwvXFZDgaYPzAVqT0Kcftu6TiceTrL8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Terminal CDKTF Alarm\"\n        title=\"\"\n        src=\"/static/1772291174209.2427872565/f058b/cdktf_alarm_created.png\"\n        srcset=\"/static/1772291174209.2427872565/c26ae/cdktf_alarm_created.png 158w,\n/static/1772291174209.2427872565/6bdcf/cdktf_alarm_created.png 315w,\n/static/1772291174209.2427872565/f058b/cdktf_alarm_created.png 630w,\n/static/1772291174209.2427872565/dc616/cdktf_alarm_created.png 933w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\nYou can view it the console as well.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1772291174208.66677872564/c655d/aws_alarm.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.78481012658228%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABGvAAARrwH3/UuEAAAA2ElEQVR42j1QCW7EIAzk/f1KX9A/9Be7agItSbjMkUiztkkXaeSxPR4D5sd5bNuOmDJSnggx4ghBo+QxpTf+NcpLeefJr0i/TxjvPXofGOPGeSKz4AiHGkqttobWO3IhFCI1yjQ53b3y/Yn09QFDterQyUZi1vrk13Whc73xgC6UHudEFYUNpZc5Vp4Xj8464twk3upjQaCG0sa83RFUKHxZLf74FeMcWJYF+76rgX4HP1uWeb/x4g45xjqHVWAtrBM4WDuju6Gca4/HkxesqpUoEK27PUT3AghZfrGKv1RNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Terminal CDKTF Alarm\"\n        title=\"\"\n        src=\"/static/1772291174208.66677872564/f058b/aws_alarm.png\"\n        srcset=\"/static/1772291174208.66677872564/c26ae/aws_alarm.png 158w,\n/static/1772291174208.66677872564/6bdcf/aws_alarm.png 315w,\n/static/1772291174208.66677872564/f058b/aws_alarm.png 630w,\n/static/1772291174208.66677872564/40601/aws_alarm.png 945w,\n/static/1772291174208.66677872564/78612/aws_alarm.png 1260w,\n/static/1772291174208.66677872564/c655d/aws_alarm.png 1586w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>To delete the test alarm, run</p>\n<pre class=\"grvsc-container abyss\" data-language=\"bash\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">cdktf destroy</span></span></span></code></pre>\n<p>In the next post, letâ€™s look at how to create multiple alarms easily and dynamically.</p>\n<blockquote>\n<p>ðŸ’‰ Find part 2 of the article here. <a href=\"https://blog.miyuru.lk/cw-alarms-using-tfcdk-2/\">https://blog.miyuru.lk/cw-alarms-using-tfcdk-2/</a></p>\n</blockquote>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .abyss { background-color: #000c18; }\n  .abyss .mtku {\n    text-decoration: underline;\n    text-underline-position: under;\n  }\n  .abyss .mtki { font-style: italic; }\n  .abyss .mtk3 { color: #384887; }\n  .abyss .mtk7 { color: #225588; }\n  .abyss .mtk1 { color: #6688CC; }\n  .abyss .mtk11 { color: #22AA44; }\n  .abyss .mtk15 { color: #9966B8; }\n  .abyss .mtk19 { color: #2277FF; }\n  .abyss .mtk4 { color: #F280D0; }\n  .abyss .mtk5 { color: #FFEEBB; }\n  .abyss .mtk6 { color: #DDBB88; }\n  .abyss .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"Creating CloudWatch Alarms using Terraform CDK (Part 1)","date":"July 25, 2021","description":"Introduction to Creating CloudWatch Alarms using Terraform CDK"}},"previous":{"fields":{"slug":"/aws-root-volume/"},"frontmatter":{"title":"AWS 1GB Debian AMI"}},"next":{"fields":{"slug":"/cw-alarms-using-tfcdk-2/"},"frontmatter":{"title":"Creating CloudWatch Alarms using Terraform CDK (Part 2)"}}},"pageContext":{"id":"479aeca2-338f-51e9-bd20-265b1b4b082e","previousPostId":"a4cd2826-8d51-5cbe-8225-b5cef687d156","nextPostId":"6a74a462-6134-5478-b13c-59ae2e589b46"}},"staticQueryHashes":["1888224856","2841359383"],"slicesMap":{}}