{"componentChunkName":"component---src-templates-blog-post-js","path":"/aws-default-vpc-ipv6/","result":{"data":{"site":{"siteMetadata":{"title":"Miyuru Tech Blog"}},"markdownRemark":{"id":"fce43757-8511-5739-bba5-96b120bfa514","excerpt":"IPv6 is the latest version of the Internet Protocol, which provides a larger address space, improved security, and enhanced performance for internetâ€¦","html":"<p>IPv6 is the latest version of the Internet Protocol, which provides a larger address space, improved security, and enhanced performance for internet communications. However, AWS does not enable IPv6 by default in the default VPC, and some steps are required to enable it.</p>\n<p>In this blog post, we will show you how to use a simple bash script to enable IPv6 support in the default VPC and subnets.</p>\n<h2>Script</h2>\n<pre class=\"grvsc-container abyss\" data-language=\"bash\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#!/bin/bash</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">vpc_id=</span><span class=\"mtk11\">$(aws ec2 describe-vpcs --filters Name=isDefault,Values=true --query &#39;Vpcs[0].VpcId&#39; --output text)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">aws ec2 associate-vpc-cidr-block --vpc-id $vpc_id --amazon-provided-ipv6-cidr-block</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">vpc_ipv6_cidr=</span><span class=\"mtk11\">$(aws ec2 describe-vpcs --vpc-ids $vpc_id --query &#39;Vpcs[0].Ipv6CidrBlockAssociationSet[0].Ipv6CidrBlock&#39; --output text)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">subnets=</span><span class=\"mtk11\">$(aws ec2 describe-subnets --filters Name=vpc-id,Values=$vpc_id --query &#39;Subnets[*].[SubnetId,AvailabilityZone]&#39; --output json)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">subnet_count=</span><span class=\"mtk11\">$(echo $subnets </span><span class=\"mtk7\">|</span><span class=\"mtk11\"> jq length)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Loop subnets</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">for</span><span class=\"mtk1\"> i </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> </span><span class=\"mtk11\">$( seq 1 $subnet_count )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    subnet_id=</span><span class=\"mtk11\">$(echo $subnets </span><span class=\"mtk7\">|</span><span class=\"mtk11\"> jq -r .[$i][0])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    subnet_az=</span><span class=\"mtk11\">$(echo $subnets </span><span class=\"mtk7\">|</span><span class=\"mtk11\"> jq -r .[$i][1])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    aws ec2 associate-subnet-cidr-block --subnet-id $subnet_id --ipv6-cidr-block ${vpc_ipv6_cidr</span><span class=\"mtk7\">::-</span><span class=\"mtk1\">7}${subnet_az</span><span class=\"mtk7\">:</span><span class=\"mtk1\"> -2}::/64</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    sleep 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    aws ec2 modify-subnet-attribute --subnet-id $subnet_id --assign-ipv6-address-on-creation</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">done</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">route_table_id=</span><span class=\"mtk11\">$(aws ec2 describe-route-tables --filters Name=vpc-id,Values=$vpc_id --query &#39;RouteTables[0].RouteTableId&#39; --output text)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">gateway_id=</span><span class=\"mtk11\">$(aws ec2 describe-internet-gateways --filters Name=attachment.vpc-id,Values=$vpc_id --query &#39;InternetGateways[0].InternetGatewayId&#39; --output text)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">aws ec2 create-route --route-table-id $route_table_id --destination-ipv6-cidr-block ::/0 --gateway-id $gateway_id</span></span></span></code></pre>\n<h2>Explanation</h2>\n<p>Here /56 for VPC and /64 for subnets are used. For subnets, last 2 letters of the Availability Zone are used. For example the subnet in <code class=\"language-text\">eu-central-1c</code> would get ip <code class=\"language-text\">2001:db8:ffff:ff1c::/64</code></p>\n<p>The script starts by getting the ID of the default VPC. Then it assigns an IPv6 CIDR block to the default VPC from the amazons IPv6 pool and get the newly assigned IPv6 CIDR.</p>\n<p>Then it gets the subnets in the default VPC and loops through them and specify the custom IPv6 CIDR sub-block to each subnet and enable <code class=\"language-text\">assign-ipv6-address-on-creation</code> in each subnet.</p>\n<p>Then it gets the ID of the route table and internet gateway of the default subnet and then create a default IPv6 route in the route table of the default subnet.</p>\n<h2>Usage</h2>\n<p>Open a cloudshell in your aws account in the region you want to enable IPv6 for the default VPC.</p>\n<p>Save the script to a file (e.g., <code class=\"language-text\">nano aws_ipv6_vpc.sh</code>).</p>\n<p>Make it executable: <code class=\"language-text\">chmod +x aws_ipv6_vpc.sh</code>.</p>\n<p>Run the script: <code class=\"language-text\">./aws_ipv6_vpc.sh</code>.</p>\n<p>Check your AWS console to verify that the subnets have IPv6 address.</p>\n<hr>\n<p>Now your EC2 instances lauched in the default VPC will have IPv6 addresses by default. Make sure the configure the security groups to allow IPv6 traffic as well.\nYou can also test the connectivity to other IPv6-enabled resources on the internet! ðŸ˜Š</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .abyss { background-color: #000c18; }\n  .abyss .mtk3 { color: #384887; }\n  .abyss .mtk1 { color: #6688CC; }\n  .abyss .mtk11 { color: #22AA44; }\n  .abyss .mtk7 { color: #225588; }\n  .abyss .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"Enabling IPv6 in Default VPC in AWS","date":"November 25, 2023","description":"Enabling IPv6 in Default VPC in AWS using bash"}},"previous":{"fields":{"slug":"/aws-cloudflare-ip-prefixlist/"},"frontmatter":{"title":"Adding Cloudflare IP to AWS Prefix List"}},"next":{"fields":{"slug":"/grafana-alerts/"},"frontmatter":{"title":"Setting up Grafana Alerts to monitor Applications"}}},"pageContext":{"id":"fce43757-8511-5739-bba5-96b120bfa514","previousPostId":"5dbc0f5a-d3f8-53f2-95f4-c8537d7cd499","nextPostId":"0a164dbd-25c9-58ef-a29a-f2555c85f8be"}},"staticQueryHashes":["1206640803","2841359383"]}