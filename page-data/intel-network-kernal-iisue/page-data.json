{"componentChunkName":"component---src-templates-blog-post-js","path":"/intel-network-kernal-iisue/","result":{"data":{"site":{"siteMetadata":{"title":"Miyuru Tech Blog"}},"markdownRemark":{"id":"b0a190a0-42b2-5b28-b229-19e2f022af79","excerpt":"I recently encountered a puzzling network issue on an Intel Network VM. The kernel was up-to-date, and all configurations seemed correct, yet the network…","html":"<p>I recently encountered a puzzling network issue on an Intel Network VM. The kernel was up-to-date, and all configurations seemed correct, yet the network connection was dropping intermittently, causing a full network outage. In this blog post, I’ll walk you through the steps I took to identify and resolve the issue.</p>\n<p><strong>The Problem:</strong></p>\n<p>The network connection on the VM would drop randomly, causing a full network outage. Upon inspecting the system logs, I found the following error message:</p>\n<p><code class=\"language-text\">[132915.070196] igb 0000:04:00.0 eth0: PCIe link lost</code></p>\n<p>This error message indicated that the PCIe link was lost on the Ethernet interface (eth0). However, I couldn’t understand why this was happening, as the kernel was up-to-date and the hardware was functioning correctly.</p>\n<p><strong>Troubleshooting Steps:</strong></p>\n<p>To troubleshoot this issue, I followed these steps:</p>\n<ol>\n<li><strong>Verified Hardware Configuration:</strong> I verified that the hardware configuration was correct and that the Ethernet interface was properly connected to the switch.</li>\n<li><strong>Checked for Firmware Updates:</strong> I checked for firmware updates for the Intel Network VM, but there were no updates available.</li>\n<li><strong>Inspected System Logs:</strong> I inspected the system logs to see if there were any other error messages related to the network interface.</li>\n</ol>\n<p><strong>The Solution:</strong></p>\n<p>After some research<sup><a href=\"https://forum.proxmox.com/threads/network-card-drop-igc-0000-09-00-0-eno1-pcie-link-lost.121295/\">1</a></sup>, I discovered that adding specific kernel parameters  might solve the issue. I added the following parameters to the kernel command line:</p>\n<p><code class=\"language-text\">pcie_port_pm=off pcie_aspm.policy=performance</code></p>\n<p>These parameters disable PCIe port power management and set the ASPM policy to performance.</p>\n<ol>\n<li>\n<p>Edit the <code class=\"language-text\">/etc/default/grub</code> file and add the following line to the <code class=\"language-text\">GRUB_CMDLINE_LINUX</code> variable:</p>\n<pre class=\"grvsc-container abyss\" data-language=\"bash\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">GRUB_CMDLINE_LINUX=</span><span class=\"mtk11\">&quot;pcie_port_pm=off pcie_aspm.policy=performance&quot;</span></span></span></code></pre>\n</li>\n<li>\n<p>run the following command to update the GRUB configuration:</p>\n<pre class=\"grvsc-container abyss\" data-language=\"bash\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">sudo update-grub</span></span></span></code></pre>\n</li>\n<li>I rebooted the system to apply the changes.</li>\n<li>Note: Verify that the kernel parameters are being applied by checking the system logs or running the <code class=\"language-text\">cat /proc/cmdline</code> command.</li>\n</ol>\n<p><strong>Conclusion:</strong></p>\n<p>In this blog post, I demonstrated how I troubleshooted and resolved a mysterious network issue on an Intel Network VM. By adding specific kernel parameters to the GRUB configuration, I was able to resolve the issue with the PCIe link and restore network connectivity.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .abyss { background-color: #000c18; }\n  .abyss .mtk1 { color: #6688CC; }\n  .abyss .mtk11 { color: #22AA44; }\n  .abyss .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"Intel Network PCIe Issue","date":"August 18, 2024","description":"Troubleshooting a Mysterious Network Issue on an Intel Network VM"}},"previous":{"fields":{"slug":"/grafana-alerts/"},"frontmatter":{"title":"Setting up Grafana Alerts to monitor Applications"}},"next":{"fields":{"slug":"/linux-google-brr/"},"frontmatter":{"title":"Speeding Up Your Network with Google BBR"}}},"pageContext":{"id":"b0a190a0-42b2-5b28-b229-19e2f022af79","previousPostId":"0a164dbd-25c9-58ef-a29a-f2555c85f8be","nextPostId":"a001be9a-af21-5d52-a9df-ec2fceb2faf6"}},"staticQueryHashes":["1206640803","2841359383"]}